/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,l=s>>2,u=(3&s)<<4|o>>4;let h=(15&o)<<2|c>>6,f=63&c;a||(f=64,r||(h=64)),i.push(n[l],n[u],n[h],n[f])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const r=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==r||null==o||null==a||null==c)throw new i;const l=r<<2|o>>4;if(s.push(l),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==c){const t=a<<6&192|c;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")},r=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=r())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}function l(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class u extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,u.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,h.prototype.create)}}class h{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(f,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new u(i,o,n)}}const f=/\{\$([^}]+)}/g;function d(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(p(n)&&p(r)){if(!d(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}const g=1e3,m=2,y=144e5,v=.5;function w(t,e=g,n=m){const i=e*Math.pow(n,t),s=Math.round(v*i*(Math.random()-.5)*2);return Math.min(y,i+s)}function b(t){return t&&t._delegate?t._delegate:t}class E{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const T="[DEFAULT]";class I{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:T})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=T){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=T){return this.instances.has(t)}getOptions(t=T){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===T?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=T){return this.component?this.component.multipleInstances?t:T:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class S{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new I(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const C=[];var A,D;(D=A||(A={}))[D.DEBUG=0]="DEBUG",D[D.VERBOSE=1]="VERBOSE",D[D.INFO=2]="INFO",D[D.WARN=3]="WARN",D[D.ERROR=4]="ERROR",D[D.SILENT=5]="SILENT";const _={debug:A.DEBUG,verbose:A.VERBOSE,info:A.INFO,warn:A.WARN,error:A.ERROR,silent:A.SILENT},N=A.INFO,k={[A.DEBUG]:"log",[A.VERBOSE]:"log",[A.INFO]:"info",[A.WARN]:"warn",[A.ERROR]:"error"},O=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=k[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class R{constructor(t){this.name=t,this._logLevel=N,this._logHandler=O,this._userLogHandler=null,C.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in A))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?_[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,A.DEBUG,...t),this._logHandler(this,A.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,A.VERBOSE,...t),this._logHandler(this,A.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,A.INFO,...t),this._logHandler(this,A.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,A.WARN,...t),this._logHandler(this,A.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,A.ERROR,...t),this._logHandler(this,A.ERROR,...t)}}const L=(t,e)=>e.some((e=>t instanceof e));let x,M;const P=new WeakMap,F=new WeakMap,V=new WeakMap,U=new WeakMap,B=new WeakMap;let j={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return F.get(t);if("objectStoreNames"===e)return t.objectStoreNames||V.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return q(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function $(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(H(this),t),q(P.get(this))}:function(...t){return q(e.apply(H(this),t))}:function(t,...n){const i=e.call(H(this),t,...n);return V.set(i,t.sort?t.sort():[t]),q(i)}:(t instanceof IDBTransaction&&function(t){if(F.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));F.set(t,e)}(t),L(t,x||(x=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,j):t);var e}function q(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(q(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&P.set(e,t)})).catch((()=>{})),B.set(e,t),e}(t);if(U.has(t))return U.get(t);const e=$(t);return e!==t&&(U.set(t,e),B.set(e,t)),e}const H=t=>B.get(t);function K(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=q(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(q(o.result),t.oldVersion,t.newVersion,q(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}const G=["get","getKey","getAll","getAllKeys","count"],z=["put","add","delete","clear"],Q=new Map;function X(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Q.get(e))return Q.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=z.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!G.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return Q.set(e,r),r}var W;W=j,j={...W,get:(t,e,n)=>X(t,e)||W.get(t,e,n),has:(t,e)=>!!X(t,e)||W.has(t,e)};class Y{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const J="@firebase/app",Z="0.9.5",tt=new R("@firebase/app"),et="[DEFAULT]",nt={[J]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},it=new Map,st=new Map;function rt(t,e){try{t.container.addComponent(e)}catch(n){tt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ot(t){const e=t.name;if(st.has(e))return tt.debug(`There were multiple attempts to register component ${e}.`),!1;st.set(e,t);for(const e of it.values())rt(e,t);return!0}function at(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const ct=new h("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class lt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ct.create("app-deleted",{appName:this._name})}}function ut(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:et,automaticDataCollectionEnabled:!1},e),s=i.name;if("string"!=typeof s||!s)throw ct.create("bad-app-name",{appName:String(s)});if(n||(n=o()),!n)throw ct.create("no-options");const r=it.get(s);if(r){if(d(n,r.options)&&d(i,r.config))return r;throw ct.create("duplicate-app",{appName:s})}const a=new S(s);for(const t of st.values())a.addComponent(t);const c=new lt(n,i,a);return it.set(s,c),c}function ht(t=et){const e=it.get(t);if(!e&&t===et)return ut();if(!e)throw ct.create("no-app",{appName:t});return e}function ft(t,e,n){var i;let s=null!==(i=nt[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void tt.warn(t.join(" "))}ot(new E(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const dt="firebase-heartbeat-database",pt=1,gt="firebase-heartbeat-store";let mt=null;function yt(){return mt||(mt=K(dt,pt,{upgrade:(t,e)=>{0===e&&t.createObjectStore(gt)}}).catch((t=>{throw ct.create("idb-open",{originalErrorMessage:t.message})}))),mt}async function vt(t,e){try{const n=(await yt()).transaction(gt,"readwrite"),i=n.objectStore(gt);return await i.put(e,wt(t)),n.done}catch(t){if(t instanceof u)tt.warn(t.message);else{const e=ct.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});tt.warn(e.message)}}}function wt(t){return`${t.name}!${t.options.appId}`}class bt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Tt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Et();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=Et(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),It(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),It(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Et(){return(new Date).toISOString().substring(0,10)}class Tt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&l().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{return(await yt()).transaction(gt).objectStore(gt).get(wt(t))}catch(t){if(t instanceof u)tt.warn(t.message);else{const e=ct.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});tt.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function It(t){return s(JSON.stringify({version:2,heartbeats:t})).length}ot(new E("platform-logger",(t=>new Y(t)),"PRIVATE")),ot(new E("heartbeat",(t=>new bt(t)),"PRIVATE")),ft(J,Z,""),ft(J,Z,"esm2017"),ft("fire-js",""),ft("firebase","9.18.0","app");const St="@firebase/installations",Ct="0.6.4",At=1e4,Dt=`w:${Ct}`,_t="FIS_v2",Nt="https://firebaseinstallations.googleapis.com/v1",kt=36e5,Ot=new h("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Rt(t){return t instanceof u&&t.code.includes("request-failed")}function Lt({projectId:t}){return`${Nt}/projects/${t}/installations`}function xt(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function Mt(t,e){const n=(await e.json()).error;return Ot.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Pt({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Ft(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Vt(t){return new Promise((e=>{setTimeout(e,t)}))}const Ut=/^[cdef][\w-]{21}$/,Bt="";function jt(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return Ut.test(e)?e:Bt}catch(t){return Bt}}function $t(t){return`${t.appName}!${t.appId}`}const qt=new Map;function Ht(t,e){const n=$t(t);Kt(n,e),function(t,e){const n=(!Gt&&"BroadcastChannel"in self&&(Gt=new BroadcastChannel("[Firebase] FID Change"),Gt.onmessage=t=>{Kt(t.data.key,t.data.fid)}),Gt);n&&n.postMessage({key:t,fid:e}),0===qt.size&&Gt&&(Gt.close(),Gt=null)}(n,e)}function Kt(t,e){const n=qt.get(t);if(n)for(const t of n)t(e)}let Gt=null;const zt="firebase-installations-database",Qt=1,Xt="firebase-installations-store";let Wt=null;function Yt(){return Wt||(Wt=K(zt,Qt,{upgrade:(t,e)=>{0===e&&t.createObjectStore(Xt)}})),Wt}async function Jt(t,e){const n=$t(t),i=(await Yt()).transaction(Xt,"readwrite"),s=i.objectStore(Xt),r=await s.get(n);return await s.put(e,n),await i.done,r&&r.fid===e.fid||Ht(t,e.fid),e}async function Zt(t){const e=$t(t),n=(await Yt()).transaction(Xt,"readwrite");await n.objectStore(Xt).delete(e),await n.done}async function te(t,e){const n=$t(t),i=(await Yt()).transaction(Xt,"readwrite"),s=i.objectStore(Xt),r=await s.get(n),o=e(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||Ht(t,o.fid),o}async function ee(t){let e;const n=await te(t.appConfig,(n=>{const i=function(t){return se(t||{fid:jt(),registrationStatus:0})}(n),s=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Ot.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=Lt(t),s=Pt(t),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={fid:n,authVersion:_t,appId:t.appId,sdkVersion:Dt},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await Ft((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:xt(t.authToken)}}throw await Mt("Create Installation",c)}(t,e);return Jt(t.appConfig,n)}catch(n){throw Rt(n)&&409===n.customData.serverCode?await Zt(t.appConfig):await Jt(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ne(t)}:{installationEntry:e}}(t,i);return e=s.registrationPromise,s.installationEntry}));return n.fid===Bt?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function ne(t){let e=await ie(t.appConfig);for(;1===e.registrationStatus;)await Vt(100),e=await ie(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await ee(t);return n||e}return e}function ie(t){return te(t,(t=>{if(!t)throw Ot.create("installation-not-found");return se(t)}))}function se(t){return 1===(e=t).registrationStatus&&e.registrationTime+At<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function re({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${Lt(t)}/${e}/authTokens:generate`}(t,n),s=function(t,{refreshToken:e}){const n=Pt(t);return n.append("Authorization",function(t){return`${_t} ${t}`}(e)),n}(t,n),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={installation:{sdkVersion:Dt,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await Ft((()=>fetch(i,a)));if(c.ok)return xt(await c.json());throw await Mt("Generate Auth Token",c)}async function oe(t,e=!1){let n;const i=await te(t.appConfig,(i=>{if(!ce(i))throw Ot.create("not-registered");const s=i.authToken;if(!e&&(2===(r=s).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+kt}(r)))return i;var r;if(1===s.requestStatus)return n=async function(t,e){let n=await ae(t.appConfig);for(;1===n.authToken.requestStatus;)await Vt(100),n=await ae(t.appConfig);const i=n.authToken;return 0===i.requestStatus?oe(t,e):i}(t,e),i;{if(!navigator.onLine)throw Ot.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await re(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await Jt(t.appConfig,i),n}catch(n){if(!Rt(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Jt(t.appConfig,n)}else await Zt(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function ae(t){return te(t,(t=>{if(!ce(t))throw Ot.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+At<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function ce(t){return void 0!==t&&2===t.registrationStatus}function le(t){return Ot.create("missing-app-config-values",{valueName:t})}const ue="installations";ot(new E(ue,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw le("App Configuration");if(!t.name)throw le("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw le(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:at(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),ot(new E("installations-internal",(t=>{const e=at(t.getProvider("app").getImmediate(),ue).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await ee(e);return i?i.catch(console.error):oe(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await ee(t);e&&await e}(n),(await oe(n,e)).token}(e,t)}}),"PRIVATE")),ft(St,Ct),ft(St,Ct,"esm2017");const he="analytics",fe="firebase_id",de="origin",pe=6e4,ge="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",me="https://www.googletagmanager.com/gtag/js",ye=new R("@firebase/analytics");function ve(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const we=new h("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),be=30,Ee=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Te(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Ie(t,e=Ee,n){const{appId:i,apiKey:s,measurementId:r}=t.options;if(!i)throw we.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw we.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Ce;return setTimeout((async()=>{a.abort()}),void 0!==n?n:pe),Se({appId:i,apiKey:s,measurementId:r},o,a,e)}async function Se(t,{throttleEndTimeMillis:e,backoffCount:n},i,s=Ee){var r;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(n,s);t.addEventListener((()=>{clearTimeout(r),i(we.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(a)return ye.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,s={method:"GET",headers:Te(i)},r=ge.replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw we.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return s.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof u&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(s.deleteThrottleMetadata(o),a)return ye.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const l=503===Number(null===(r=null==c?void 0:c.customData)||void 0===r?void 0:r.httpStatus)?w(n,s.intervalMillis,be):w(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return s.setThrottleMetadata(o,h),ye.debug(`Calling attemptFetch again in ${l} millis`),Se(t,h,i,s)}}class Ce{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Ae,De;async function _e(t,e,n,i,s,r,o){var a;const u=Ie(t);u.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&ye.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>ye.error(t))),e.push(u);const h=async function(){if(!c())return ye.warn(we.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await l()}catch(t){return ye.warn(we.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[f,d]=await Promise.all([u,h]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(me)&&n.src.includes(t))return n;return null})(r)||function(t,e){const n=document.createElement("script");n.src=`${me}?l=${t}&id=${e}`,n.async=!0,document.head.appendChild(n)}(r,f.measurementId),De&&(s("consent","default",De),De=void 0),s("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p[de]="firebase",p.update=!0,null!=d&&(p[fe]=d),s("config",f.measurementId,p),Ae&&(s("set",Ae),Ae=void 0),f.measurementId}class Ne{constructor(t){this.app=t}_delete(){return delete ke[this.app.options.appId],Promise.resolve()}}let ke={},Oe=[];const Re={};let Le,xe,Me="dataLayer",Pe="gtag",Fe=!1;function Ve(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=we.create("invalid-analytics-context",{errorInfo:e});ye.warn(n.message)}}();const i=t.options.appId;if(!i)throw we.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw we.create("no-api-key");ye.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=ke[i])throw we.create("already-exists",{id:i});if(!Fe){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(Me);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,s){let r=function(...t){window[i].push(arguments)};return window[s]&&"function"==typeof window[s]&&(r=window[s]),window[s]=function(t,e,n,i){return async function(s,r,o){try{"event"===s?await async function(t,e,n,i,s){try{let r=[];if(s&&s.send_to){let t=s.send_to;Array.isArray(t)||(t=[t]);const i=await ve(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),s=t&&e[t.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(e)),await Promise.all(r),t("event",i,s||{})}catch(t){ye.error(t)}}(t,e,n,r,o):"config"===s?await async function(t,e,n,i,s,r){const o=i[s];try{if(o)await e[o];else{const t=(await ve(n)).find((t=>t.measurementId===s));t&&await e[t.appId]}}catch(t){ye.error(t)}t("config",s,r)}(t,e,n,i,r,o):"consent"===s?t("consent","update",o):t("set",r)}catch(t){ye.error(t)}}}(r,t,e,n),{gtagCore:r,wrappedGtag:window[s]}}(ke,Oe,Re,Me,Pe);xe=t,Le=e,Fe=!0}return ke[i]=_e(t,Oe,Re,e,Le,Me,n),new Ne(t)}const Ue="@firebase/analytics",Be="0.9.4";ot(new E(he,((t,{options:e})=>Ve(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),ot(new E("analytics-internal",(function(t){try{const e=t.getProvider(he).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=b(t),async function(t,e,n,i,s){if(s&&s.global)t("event",n,i);else{const s=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(xe,ke[t.app.options.appId],e,n,i).catch((t=>ye.error(t)))}(e,t,n,i)}}catch(t){throw we.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),ft(Ue,Be),ft(Ue,Be,"esm2017");var je,$e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{},qe={},He=He||{},Ke=$e||self;function Ge(){}function ze(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Qe(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Xe="closure_uid_"+(1e9*Math.random()>>>0),We=0;function Ye(t,e,n){return t.call.apply(t.bind,arguments)}function Je(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Ze(t,e,n){return(Ze=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ye:Je).apply(null,arguments)}function tn(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function en(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Wb=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}function nn(){this.s=this.s,this.o=this.o}nn.prototype.s=!1,nn.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Xe)&&t[Xe]||(t[Xe]=++We))},nn.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const sn=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function rn(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function on(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(ze(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let s=0;s<i;s++)t[e+s]=n[s]}else t.push(n)}}function an(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}an.prototype.h=function(){this.defaultPrevented=!0};var cn=function(){if(!Ke.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Ke.addEventListener("test",Ge,e),Ke.removeEventListener("test",Ge,e)}catch(t){}return t}();function ln(t){return/^[\s\xa0]*$/.test(t)}var un=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function hn(t,e){return t<e?-1:t>e?1:0}function fn(){var t=Ke.navigator;return t&&(t=t.userAgent)?t:""}function dn(t){return-1!=fn().indexOf(t)}function pn(t){return pn[" "](t),t}pn[" "]=Ge;var gn,mn,yn=dn("Opera"),vn=dn("Trident")||dn("MSIE"),wn=dn("Edge"),bn=wn||vn,En=dn("Gecko")&&!(-1!=fn().toLowerCase().indexOf("webkit")&&!dn("Edge"))&&!(dn("Trident")||dn("MSIE"))&&!dn("Edge"),Tn=-1!=fn().toLowerCase().indexOf("webkit")&&!dn("Edge");function In(){var t=Ke.document;return t?t.documentMode:void 0}t:{var Sn="",Cn=(mn=fn(),En?/rv:([^\);]+)(\)|;)/.exec(mn):wn?/Edge\/([\d\.]+)/.exec(mn):vn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(mn):Tn?/WebKit\/(\S+)/.exec(mn):yn?/(?:Version)[ \/]?(\S+)/.exec(mn):void 0);if(Cn&&(Sn=Cn?Cn[1]:""),vn){var An=In();if(null!=An&&An>parseFloat(Sn)){gn=String(An);break t}}gn=Sn}var Dn,_n={};function Nn(){return function(t){var e=_n;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let t=0;const e=un(String(gn)).split("."),n=un("9").split("."),i=Math.max(e.length,n.length);for(let o=0;0==t&&o<i;o++){var s=e[o]||"",r=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==s[0].length&&0==r[0].length)break;t=hn(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||hn(0==s[2].length,0==r[2].length)||hn(s[2],r[2]),s=s[3],r=r[3]}while(0==t)}return 0<=t}()}()}Ke.document&&vn?Dn=In()||parseInt(gn,10)||void 0:Dn=void 0;var kn=Dn;function On(t,e){if(an.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(En){t:{try{pn(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Rn[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&On.X.h.call(this)}}en(On,an);var Rn={2:"touch",3:"pen",4:"mouse"};On.prototype.h=function(){On.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ln="closure_listenable_"+(1e6*Math.random()|0),xn=0;function Mn(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.ha=s,this.key=++xn,this.ba=this.ea=!1}function Pn(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function Fn(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function Vn(t){const e={};for(const n in t)e[n]=t[n];return e}const Un="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Bn(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<Un.length;e++)n=Un[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function jn(t){this.src=t,this.g={},this.h=0}function $n(t,e){var n=e.type;if(n in t.g){var i,s=t.g[n],r=sn(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Pn(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function qn(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.ba&&r.listener==e&&r.capture==!!n&&r.ha==i)return s}return-1}jn.prototype.add=function(t,e,n,i,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=qn(t,e,i,s);return-1<o?(e=t[o],n||(e.ea=!1)):((e=new Mn(e,this.src,r,!!i,s)).ea=n,t.push(e)),e};var Hn="closure_lm_"+(1e6*Math.random()|0),Kn={};function Gn(t,e,n,i,s){if(i&&i.once)return Qn(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)Gn(t,e[r],n,i,s);return null}return n=ei(n),t&&t[Ln]?t.N(e,n,Qe(i)?!!i.capture:!!i,s):zn(t,e,n,!1,i,s)}function zn(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");var o=Qe(s)?!!s.capture:!!s,a=Zn(t);if(a||(t[Hn]=a=new jn(t)),(n=a.add(e,n,i,o,r)).proxy)return n;if(i=function(){const t=Jn;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)cn||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(Yn(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function Qn(t,e,n,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)Qn(t,e[r],n,i,s);return null}return n=ei(n),t&&t[Ln]?t.O(e,n,Qe(i)?!!i.capture:!!i,s):zn(t,e,n,!0,i,s)}function Xn(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)Xn(t,e[r],n,i,s);else i=Qe(i)?!!i.capture:!!i,n=ei(n),t&&t[Ln]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=qn(r=t.g[e],n,i,s))&&(Pn(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=Zn(t))&&(e=t.g[e.toString()],t=-1,e&&(t=qn(e,n,i,s)),(n=-1<t?e[t]:null)&&Wn(n))}function Wn(t){if("number"!=typeof t&&t&&!t.ba){var e=t.src;if(e&&e[Ln])$n(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(Yn(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=Zn(e))?($n(n,t),0==n.h&&(n.src=null,e[Hn]=null)):Pn(t)}}}function Yn(t){return t in Kn?Kn[t]:Kn[t]="on"+t}function Jn(t,e){if(t.ba)t=!0;else{e=new On(e,this);var n=t.listener,i=t.ha||t.src;t.ea&&Wn(t),t=n.call(i,e)}return t}function Zn(t){return(t=t[Hn])instanceof jn?t:null}var ti="__closure_events_fn_"+(1e9*Math.random()>>>0);function ei(t){return"function"==typeof t?t:(t[ti]||(t[ti]=function(e){return t.handleEvent(e)}),t[ti])}function ni(){nn.call(this),this.i=new jn(this),this.P=this,this.I=null}function ii(t,e){var n,i=t.I;if(i)for(n=[];i;i=i.I)n.push(i);if(t=t.P,i=e.type||e,"string"==typeof e)e=new an(e,t);else if(e instanceof an)e.target=e.target||t;else{var s=e;Bn(e=new an(i,t),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=si(o,i,!0,e)&&s}if(s=si(o=e.g=t,i,!0,e)&&s,s=si(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)s=si(o=e.g=n[r],i,!1,e)&&s}function si(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&$n(t.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}en(ni,nn),ni.prototype[Ln]=!0,ni.prototype.removeEventListener=function(t,e,n,i){Xn(this,t,e,n,i)},ni.prototype.M=function(){if(ni.X.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)Pn(n[i]);delete e.g[t],e.h--}}this.I=null},ni.prototype.N=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},ni.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var ri=Ke.JSON.stringify;function oi(){var t=di;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var ai,ci=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new li),(t=>t.reset()));class li{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function ui(t){Ke.setTimeout((()=>{throw t}),0)}function hi(t,e){ai||function(){var t=Ke.Promise.resolve(void 0);ai=function(){t.then(pi)}}(),fi||(ai(),fi=!0),di.add(t,e)}var fi=!1,di=new class{constructor(){this.h=this.g=null}add(t,e){const n=ci.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function pi(){for(var t;t=oi();){try{t.h.call(t.g)}catch(t){ui(t)}var e=ci;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}fi=!1}function gi(t,e){ni.call(this),this.h=t||1,this.g=e||Ke,this.j=Ze(this.lb,this),this.l=Date.now()}function mi(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}function yi(t,e,n){if("function"==typeof t)n&&(t=Ze(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Ze(t.handleEvent,t)}return 2147483647<Number(e)?-1:Ke.setTimeout(t,e||0)}function vi(t){t.g=yi((()=>{t.g=null,t.i&&(t.i=!1,vi(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}en(gi,ni),(je=gi.prototype).ca=!1,je.R=null,je.lb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),ii(this,"tick"),this.ca&&(mi(this),this.start()))}},je.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},je.M=function(){gi.X.M.call(this),mi(this),delete this.g};class wi extends nn{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:vi(this)}M(){super.M(),this.g&&(Ke.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function bi(t){nn.call(this),this.h=t,this.g={}}en(bi,nn);var Ei=[];function Ti(t,e,n,i){Array.isArray(n)||(n&&(Ei[0]=n.toString()),n=Ei);for(var s=0;s<n.length;s++){var r=Gn(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Ii(t){Fn(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Wn(t)}),t),t.g={}}function Si(){this.g=!0}function Ci(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return ri(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}bi.prototype.M=function(){bi.X.M.call(this),Ii(this)},bi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Si.prototype.Aa=function(){this.g=!1},Si.prototype.info=function(){};var Ai={},Di=null;function _i(){return Di=Di||new ni}function Ni(t){an.call(this,Ai.Pa,t)}function ki(t){const e=_i();ii(e,new Ni(e))}function Oi(t,e){an.call(this,Ai.STAT_EVENT,t),this.stat=e}function Ri(t){const e=_i();ii(e,new Oi(e,t))}function Li(t,e){an.call(this,Ai.Qa,t),this.size=e}function xi(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Ke.setTimeout((function(){t()}),e)}Ai.Pa="serverreachability",en(Ni,an),Ai.STAT_EVENT="statevent",en(Oi,an),Ai.Qa="timingevent",en(Li,an);var Mi={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Pi={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Fi(){}function Vi(t){return t.h||(t.h=t.i())}function Ui(){}Fi.prototype.h=null;var Bi,ji={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function $i(){an.call(this,"d")}function qi(){an.call(this,"c")}function Hi(){}function Ki(t,e,n,i){this.l=t,this.j=e,this.m=n,this.U=i||1,this.S=new bi(this),this.O=zi,t=bn?125:void 0,this.T=new gi(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Gi}function Gi(){this.i=null,this.g="",this.h=!1}en($i,an),en(qi,an),en(Hi,Fi),Hi.prototype.g=function(){return new XMLHttpRequest},Hi.prototype.i=function(){return{}},Bi=new Hi;var zi=45e3,Qi={},Xi={};function Wi(t,e,n){t.K=1,t.v=gs(us(e)),t.s=n,t.P=!0,Yi(t,null)}function Yi(t,e){t.F=Date.now(),es(t),t.A=us(t.v);var n=t.A,i=t.U;Array.isArray(i)||(i=[String(i)]),_s(n.i,"t",i),t.C=0,n=t.l.H,t.h=new Gi,t.g=Dr(t.l,n?e:null,!t.s),0<t.N&&(t.L=new wi(Ze(t.La,t,t.g),t.N)),Ti(t.S,t.g,"readystatechange",t.ib),e=t.H?Vn(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),ki(),function(t,e,n,i,s,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.U,t.s)}function Ji(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Da}function Zi(t,e,n){let i,s=!0;for(;!t.I&&t.C<n.length;){if(i=ts(t,n),i==Xi){4==e&&(t.o=4,Ri(14),s=!1),Ci(t.j,t.m,null,"[Incomplete Response]");break}if(i==Qi){t.o=4,Ri(15),Ci(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Ci(t.j,t.m,i,null),os(t,i)}Ji(t)&&i!=Xi&&i!=Qi&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Ri(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.$&&(t.$=!0,(e=t.l).g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),wr(e),e.K=!0,Ri(11))):(Ci(t.j,t.m,n,"[Invalid Chunked Response]"),rs(t),ss(t))}function ts(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?Xi:(n=Number(e.substring(n,i)),isNaN(n)?Qi:(i+=1)+n>e.length?Xi:(e=e.substr(i,n),t.C=i+n,e))}function es(t){t.V=Date.now()+t.O,ns(t,t.O)}function ns(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=xi(Ze(t.gb,t),e)}function is(t){t.B&&(Ke.clearTimeout(t.B),t.B=null)}function ss(t){0==t.l.G||t.I||Tr(t.l,t)}function rs(t){is(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,mi(t.T),Ii(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function os(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||xs(n.h,t)))if(!t.J&&xs(n.h,t)&&3==n.G){try{var i=n.Fa.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Er(n),hr(n)}vr(n),Ri(18)}}else n.Ba=s[1],0<n.Ba-n.T&&37500>s[2]&&n.L&&0==n.A&&!n.v&&(n.v=xi(Ze(n.cb,n),6e3));if(1>=Ls(n.h)&&n.ja){try{n.ja()}catch(t){}n.ja=void 0}}else Sr(n,11)}else if((t.J||n.g==t)&&Er(n),!ln(e))for(s=n.Fa.g.parse(e),e=0;e<s.length;e++){let l=s[e];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.I=l[1],n.ka=l[2];const e=l[3];null!=e&&(n.ma=e,n.j.info("VER="+n.ma));const s=l[4];null!=s&&(n.Ca=s,n.j.info("SVER="+n.Ca));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(i=1.5*u,n.J=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=i.h;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(Ms(r,r.h),r.h=null))}if(i.D){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.za=t,ps(i.F,i.D,t))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=t;if((i=n).sa=Ar(i,i.H?i.ka:null,i.V),o.J){Ps(i.h,o);var a=o,c=i.J;c&&a.setTimeout(c),a.B&&(is(a),es(a)),i.g=o}else yr(i);0<n.i.length&&dr(n)}else"stop"!=l[0]&&"close"!=l[0]||Sr(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?Sr(n,7):ur(n):"noop"!=l[0]&&n.l&&n.l.wa(l),n.A=0)}ki()}catch(t){}}function as(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ze(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.oa&&"function"==typeof t.oa)return t.oa();if(!t.W||"function"!=typeof t.W){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(ze(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.W&&"function"==typeof t.W)return t.W();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(ze(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),s=i.length,r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}(je=Ki.prototype).setTimeout=function(t){this.O=t},je.ib=function(t){t=t.target;const e=this.L;e&&3==sr(t)?e.l():this.La(t)},je.La=function(t){try{if(t==this.g)t:{const u=sr(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>u)&&(3!=u||bn||this.g&&(this.h.h||this.g.fa()||rr(this.g)))){this.I||4!=u||7==e||ki(),is(this);var n=this.g.aa();this.Y=n;e:if(Ji(this)){var i=rr(this.g);t="";var s=i.length,r=4==sr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){rs(this),ss(this);var o="";break e}this.h.i=new Ke.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(t,e,n,i,s,r,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.U,u,n),this.i){if(this.Z&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ln(a)){var l=a;break e}}l=null}if(!(n=l)){this.i=!1,this.o=3,Ri(12),rs(this),ss(this);break t}Ci(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,os(this,n)}this.P?(Zi(this,u,o),bn&&this.i&&3==u&&(Ti(this.S,this.T,"tick",this.hb),this.T.start())):(Ci(this.j,this.m,o,null),os(this,o)),4==u&&rs(this),this.i&&!this.I&&(4==u?Tr(this.l,this):(this.i=!1,es(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Ri(12)):(this.o=0,Ri(13)),rs(this),ss(this)}}}catch(t){}},je.hb=function(){if(this.g){var t=sr(this.g),e=this.g.fa();this.C<e.length&&(is(this),Zi(this,t,e),this.i&&4!=t&&es(this))}},je.cancel=function(){this.I=!0,rs(this)},je.gb=function(){this.B=null;const t=Date.now();0<=t-this.V?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(ki(),Ri(17)),rs(this),this.o=2,ss(this)):ns(this,this.V-t)};var cs=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ls(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof ls){this.h=void 0!==e?e:t.h,hs(this,t.j),this.s=t.s,this.g=t.g,fs(this,t.m),this.l=t.l,e=t.i;var n=new Ss;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),ds(this,n),this.o=t.o}else t&&(n=String(t).match(cs))?(this.h=!!e,hs(this,n[1]||"",!0),this.s=ms(n[2]||""),this.g=ms(n[3]||"",!0),fs(this,n[4]),this.l=ms(n[5]||"",!0),ds(this,n[6]||"",!0),this.o=ms(n[7]||"")):(this.h=!!e,this.i=new Ss(null,this.h))}function us(t){return new ls(t)}function hs(t,e,n){t.j=n?ms(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function fs(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function ds(t,e,n){e instanceof Ss?(t.i=e,function(t,e){e&&!t.j&&(Cs(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(As(this,e),_s(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=ys(e,Ts)),t.i=new Ss(e,t.h))}function ps(t,e,n){t.i.set(e,n)}function gs(t){return ps(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ms(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ys(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,vs),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function vs(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ls.prototype.toString=function(){var t=[],e=this.j;e&&t.push(ys(e,ws,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(ys(e,ws,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(ys(n,"/"==n.charAt(0)?Es:bs,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",ys(n,Is)),t.join("")};var ws=/[#\/\?@]/g,bs=/[#\?:]/g,Es=/[#\?]/g,Ts=/[#\?@]/g,Is=/#/g;function Ss(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Cs(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function As(t,e){Cs(t),e=Ns(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ds(t,e){return Cs(t),e=Ns(t,e),t.g.has(e)}function _s(t,e,n){As(t,e),0<n.length&&(t.i=null,t.g.set(Ns(t,e),rn(n)),t.h+=n.length)}function Ns(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function ks(t){this.l=t||Os,t=Ke.PerformanceNavigationTiming?0<(t=Ke.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Ke.g&&Ke.g.Ga&&Ke.g.Ga()&&Ke.g.Ga().$b),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(je=Ss.prototype).add=function(t,e){Cs(this),this.i=null,t=Ns(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},je.forEach=function(t,e){Cs(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},je.oa=function(){Cs(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const s=t[i];for(let t=0;t<s.length;t++)n.push(e[i])}return n},je.W=function(t){Cs(this);let e=[];if("string"==typeof t)Ds(this,t)&&(e=e.concat(this.g.get(Ns(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},je.set=function(t,e){return Cs(this),this.i=null,Ds(this,t=Ns(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},je.get=function(t,e){return t&&0<(t=this.W(t)).length?String(t[0]):e},je.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const r=encodeURIComponent(String(i)),o=this.W(i);for(i=0;i<o.length;i++){var s=r;""!==o[i]&&(s+="="+encodeURIComponent(String(o[i]))),t.push(s)}}return this.i=t.join("&")};var Os=10;function Rs(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Ls(t){return t.h?1:t.g?t.g.size:0}function xs(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Ms(t,e){t.g?t.g.add(e):t.h=e}function Ps(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Fs(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return rn(t.i)}function Vs(){}function Us(){this.g=new Vs}function Bs(t,e,n){const i=n||"";try{as(t,(function(t,n){let s=t;Qe(t)&&(s=ri(t)),e.push(i+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function js(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch(t){}}function $s(t){this.l=t.ac||null,this.j=t.jb||!1}function qs(t,e){ni.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Hs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ks.prototype.cancel=function(){if(this.i=Fs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},Vs.prototype.stringify=function(t){return Ke.JSON.stringify(t,void 0)},Vs.prototype.parse=function(t){return Ke.JSON.parse(t,void 0)},en($s,Fi),$s.prototype.g=function(){return new qs(this.l,this.j)},$s.prototype.i=function(t){return function(){return t}}({}),en(qs,ni);var Hs=0;function Ks(t){t.j.read().then(t.Ta.bind(t)).catch(t.ga.bind(t))}function Gs(t){t.readyState=4,t.l=null,t.j=null,t.A=null,zs(t)}function zs(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(je=qs.prototype).open=function(t,e){if(this.readyState!=Hs)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,zs(this)},je.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||Ke).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},je.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Gs(this)),this.readyState=Hs},je.Wa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,zs(this)),this.g&&(this.readyState=3,zs(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==Ke.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ks(this)}else t.text().then(this.Va.bind(this),this.ga.bind(this))},je.Ta=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Gs(this):zs(this),3==this.readyState&&Ks(this)}},je.Va=function(t){this.g&&(this.response=this.responseText=t,Gs(this))},je.Ua=function(t){this.g&&(this.response=t,Gs(this))},je.ga=function(){this.g&&Gs(this)},je.setRequestHeader=function(t,e){this.v.append(t,e)},je.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},je.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(qs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Qs=Ke.JSON.parse;function Xs(t){ni.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ws,this.K=this.L=!1}en(Xs,ni);var Ws="",Ys=/^https?$/i,Js=["POST","PUT"];function Zs(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,tr(t),nr(t)}function tr(t){t.D||(t.D=!0,ii(t,"complete"),ii(t,"error"))}function er(t){if(t.h&&void 0!==He&&(!t.C[1]||4!=sr(t)||2!=t.aa()))if(t.v&&4==sr(t))yi(t.Ha,0,t);else if(ii(t,"readystatechange"),4==sr(t)){t.h=!1;try{const a=t.aa();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===a){var s=String(t.H).match(cs)[1]||null;if(!s&&Ke.self&&Ke.self.location){var r=Ke.self.location.protocol;s=r.substr(0,r.length-1)}i=!Ys.test(s?s.toLowerCase():"")}n=i}if(n)ii(t,"complete"),ii(t,"success");else{t.m=6;try{var o=2<sr(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.aa()+"]",tr(t)}}finally{nr(t)}}}function nr(t,e){if(t.g){ir(t);const n=t.g,i=t.C[0]?Ge:null;t.g=null,t.C=null,e||ii(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function ir(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(Ke.clearTimeout(t.A),t.A=null)}function sr(t){return t.g?t.g.readyState:0}function rr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Ws:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function or(t){let e="";return Fn(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function ar(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=or(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ps(t,e,n))}function cr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function lr(t){this.Ca=0,this.i=[],this.j=new Si,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=cr("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=cr("baseRetryDelayMs",5e3,t),this.bb=cr("retryDelaySeedMs",1e4,t),this.$a=cr("forwardChannelMaxRetries",2,t),this.ta=cr("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Zb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new ks(t&&t.concurrentRequestLimit),this.Fa=new Us,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=t&&t.Xb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function ur(t){if(fr(t),3==t.G){var e=t.U++,n=us(t.F);ps(n,"SID",t.I),ps(n,"RID",e),ps(n,"TYPE","terminate"),gr(t,n),(e=new Ki(t,t.j,e,void 0)).K=2,e.v=gs(us(n)),n=!1,Ke.navigator&&Ke.navigator.sendBeacon&&(n=Ke.navigator.sendBeacon(e.v.toString(),"")),!n&&Ke.Image&&((new Image).src=e.v,n=!0),n||(e.g=Dr(e.l,null),e.g.da(e.v)),e.F=Date.now(),es(e)}Cr(t)}function hr(t){t.g&&(wr(t),t.g.cancel(),t.g=null)}function fr(t){hr(t),t.u&&(Ke.clearTimeout(t.u),t.u=null),Er(t),t.h.cancel(),t.m&&("number"==typeof t.m&&Ke.clearTimeout(t.m),t.m=null)}function dr(t){Rs(t.h)||t.m||(t.m=!0,hi(t.Ja,t),t.C=0)}function pr(t,e){var n;n=e?e.m:t.U++;const i=us(t.F);ps(i,"SID",t.I),ps(i,"RID",n),ps(i,"AID",t.T),gr(t,i),t.o&&t.s&&ar(i,t.o,t.s),n=new Ki(t,t.j,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=mr(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),Ms(t.h,n),Wi(n,i,e)}function gr(t,e){t.ia&&Fn(t.ia,(function(t,n){ps(e,n,t)})),t.l&&as({},(function(t,n){ps(e,n,t)}))}function mr(t,e,n){n=Math.min(t.i.length,n);var i=t.l?Ze(t.l.Ra,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=e,0>n)e=Math.max(0,s[o].h-100),r=!1;else try{Bs(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(r){i=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,i}function yr(t){t.g||t.u||(t.Z=1,hi(t.Ia,t),t.A=0)}function vr(t){return!(t.g||t.u||3<=t.A||(t.Z++,t.u=xi(Ze(t.Ia,t),Ir(t,t.A)),t.A++,0))}function wr(t){null!=t.B&&(Ke.clearTimeout(t.B),t.B=null)}function br(t){t.g=new Ki(t,t.j,"rpc",t.Z),null===t.o&&(t.g.H=t.s),t.g.N=0;var e=us(t.sa);ps(e,"RID","rpc"),ps(e,"SID",t.I),ps(e,"CI",t.L?"0":"1"),ps(e,"AID",t.T),ps(e,"TYPE","xmlhttp"),gr(t,e),t.o&&t.s&&ar(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=gs(us(e)),n.s=null,n.P=!0,Yi(n,t)}function Er(t){null!=t.v&&(Ke.clearTimeout(t.v),t.v=null)}function Tr(t,e){var n=null;if(t.g==e){Er(t),wr(t),t.g=null;var i=2}else{if(!xs(t.h,e))return;n=e.D,Ps(t.h,e),i=1}if(0!=t.G)if(t.pa=e.Y,e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;ii(i=_i(),new Li(i,n)),dr(t)}else yr(t);else if(3==(s=e.o)||0==s&&0<t.pa||!(1==i&&function(t,e){return!(Ls(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.C>=(t.Za?0:t.$a)||(t.m=xi(Ze(t.Ja,t,e),Ir(t,t.C)),t.C++,0)))}(t,e)||2==i&&vr(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),s){case 1:Sr(t,5);break;case 4:Sr(t,10);break;case 3:Sr(t,6);break;default:Sr(t,2)}}function Ir(t,e){let n=t.Xa+Math.floor(Math.random()*t.bb);return t.l||(n*=2),n*e}function Sr(t,e){if(t.j.info("Error code "+e),2==e){var n=null;t.l&&(n=null);var i=Ze(t.kb,t);n||(n=new ls("//www.google.com/images/cleardot.gif"),Ke.location&&"http"==Ke.location.protocol||hs(n,"https"),gs(n)),function(t,e){const n=new Si;if(Ke.Image){const i=new Image;i.onload=tn(js,n,i,"TestLoadImage: loaded",!0,e),i.onerror=tn(js,n,i,"TestLoadImage: error",!1,e),i.onabort=tn(js,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=tn(js,n,i,"TestLoadImage: timeout",!1,e),Ke.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else Ri(2);t.G=0,t.l&&t.l.va(e),Cr(t),fr(t)}function Cr(t){if(t.G=0,t.la=[],t.l){const e=Fs(t.h);0==e.length&&0==t.i.length||(on(t.la,e),on(t.la,t.i),t.h.i.length=0,rn(t.i),t.i.length=0),t.l.ua()}}function Ar(t,e,n){var i=n instanceof ls?us(n):new ls(n,void 0);if(""!=i.g)e&&(i.g=e+"."+i.g),fs(i,i.m);else{var s=Ke.location;i=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var r=new ls(null,void 0);i&&hs(r,i),e&&(r.g=e),s&&fs(r,s),n&&(r.l=n),i=r}return n=t.D,e=t.za,n&&e&&ps(i,n,e),ps(i,"VER",t.ma),gr(t,i),i}function Dr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Da&&!t.ra?new Xs(new $s({jb:!0})):new Xs(t.ra)).Ka(t.H),e}function _r(){}function Nr(){if(vn&&!(10<=Number(kn)))throw Error("Environmental error: no available transport.")}function kr(t,e){ni.call(this),this.g=new lr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Yb)&&!ln(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ln(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Lr(this)}function Or(t){$i.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Rr(){qi.call(this),this.status=1}function Lr(t){this.g=t}(je=Xs.prototype).Ka=function(t){this.L=t},je.da=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Bi.g(),this.C=this.u?Vi(this.u):Vi(Bi),this.g.onreadystatechange=Ze(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Zs(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=Ke.FormData&&t instanceof Ke.FormData,!(0<=sn(Js,e))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ir(this),0<this.B&&((this.K=function(t){return vn&&Nn()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ze(this.qa,this)):this.A=yi(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Zs(this,t)}},je.qa=function(){void 0!==He&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ii(this,"timeout"),this.abort(8))},je.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,ii(this,"complete"),ii(this,"abort"),nr(this))},je.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),nr(this,!0)),Xs.X.M.call(this)},je.Ha=function(){this.s||(this.F||this.v||this.l?er(this):this.fb())},je.fb=function(){er(this)},je.aa=function(){try{return 2<sr(this)?this.g.status:-1}catch(t){return-1}},je.fa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},je.Sa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Qs(e)}},je.Ea=function(){return this.m},je.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(je=lr.prototype).ma=8,je.G=1,je.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new Ki(this,this.j,t,void 0);let r=this.s;if(this.S&&(r?(r=Vn(r),Bn(r,this.S)):r=this.S),null!==this.o||this.N||(s.H=r,r=null),this.O)t:{for(var e=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=mr(this,s,e),ps(n=us(this.F),"RID",t),ps(n,"CVER",22),this.D&&ps(n,"X-HTTP-Session-Id",this.D),gr(this,n),r&&(this.N?e="headers="+encodeURIComponent(String(or(r)))+"&"+e:this.o&&ar(n,this.o,r)),Ms(this.h,s),this.Ya&&ps(n,"TYPE","init"),this.O?(ps(n,"$req",e),ps(n,"SID","null"),s.Z=!0,Wi(s,n,null)):Wi(s,n,e),this.G=2}}else 3==this.G&&(t?pr(this,t):0==this.i.length||Rs(this.h)||pr(this))},je.Ia=function(){if(this.u=null,br(this),this.$&&!(this.K||null==this.g||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=xi(Ze(this.eb,this),t)}},je.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ri(10),hr(this),br(this))},je.cb=function(){null!=this.v&&(this.v=null,hr(this),vr(this),Ri(19))},je.kb=function(t){t?(this.j.info("Successfully pinged google.com"),Ri(2)):(this.j.info("Failed to ping google.com"),Ri(1))},(je=_r.prototype).xa=function(){},je.wa=function(){},je.va=function(){},je.ua=function(){},je.Ra=function(){},Nr.prototype.g=function(t,e){return new kr(t,e)},en(kr,ni),kr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;Ri(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=Ar(t,null,t.V),dr(t)},kr.prototype.close=function(){ur(this.g)},kr.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=ri(t),t=n);e.i.push(new class{constructor(t,e){this.h=t,this.g=e}}(e.ab++,t)),3==e.G&&dr(e)},kr.prototype.M=function(){this.g.l=null,delete this.j,ur(this.g),delete this.g,kr.X.M.call(this)},en(Or,$i),en(Rr,qi),en(Lr,_r),Lr.prototype.xa=function(){ii(this.g,"a")},Lr.prototype.wa=function(t){ii(this.g,new Or(t))},Lr.prototype.va=function(t){ii(this.g,new Rr)},Lr.prototype.ua=function(){ii(this.g,"b")},Nr.prototype.createWebChannel=Nr.prototype.g,kr.prototype.send=kr.prototype.u,kr.prototype.open=kr.prototype.m,kr.prototype.close=kr.prototype.close,Mi.NO_ERROR=0,Mi.TIMEOUT=8,Mi.HTTP_ERROR=6,Pi.COMPLETE="complete",Ui.EventType=ji,ji.OPEN="a",ji.CLOSE="b",ji.ERROR="c",ji.MESSAGE="d",ni.prototype.listen=ni.prototype.N,Xs.prototype.listenOnce=Xs.prototype.O,Xs.prototype.getLastError=Xs.prototype.Oa,Xs.prototype.getLastErrorCode=Xs.prototype.Ea,Xs.prototype.getStatus=Xs.prototype.aa,Xs.prototype.getResponseJson=Xs.prototype.Sa,Xs.prototype.getResponseText=Xs.prototype.fa,Xs.prototype.send=Xs.prototype.da,Xs.prototype.setWithCredentials=Xs.prototype.Ka;var xr=qe.createWebChannelTransport=function(){return new Nr},Mr=qe.getStatEventTarget=function(){return _i()},Pr=qe.ErrorCode=Mi,Fr=qe.EventType=Pi,Vr=qe.Event=Ai,Ur=qe.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Br=qe.FetchXmlHttpFactory=$s,jr=qe.WebChannel=Ui,$r=qe.XhrIo=Xs;const qr="@firebase/firestore";class Hr{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Hr.UNAUTHENTICATED=new Hr(null),Hr.GOOGLE_CREDENTIALS=new Hr("google-credentials-uid"),Hr.FIRST_PARTY=new Hr("first-party-uid"),Hr.MOCK_USER=new Hr("mock-user");let Kr="9.18.0";const Gr=new R("@firebase/firestore");function zr(){return Gr.logLevel}function Qr(t,...e){if(Gr.logLevel<=A.DEBUG){const n=e.map(Yr);Gr.debug(`Firestore (${Kr}): ${t}`,...n)}}function Xr(t,...e){if(Gr.logLevel<=A.ERROR){const n=e.map(Yr);Gr.error(`Firestore (${Kr}): ${t}`,...n)}}function Wr(t,...e){if(Gr.logLevel<=A.WARN){const n=e.map(Yr);Gr.warn(`Firestore (${Kr}): ${t}`,...n)}}function Yr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Jr(t="Unexpected state"){const e=`FIRESTORE (${Kr}) INTERNAL ASSERTION FAILED: `+t;throw Xr(e),new Error(e)}function Zr(t,e){t||Jr()}function to(t,e){return t}const eo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class no extends u{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class io{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class so{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class ro{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Hr.UNAUTHENTICATED)))}shutdown(){}}class oo{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class ao{constructor(t){this.t=t,this.currentUser=Hr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new io;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new io,t.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{Qr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Qr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new io)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Qr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Zr("string"==typeof e.accessToken),new so(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Zr(null===t||"string"==typeof t),new Hr(t)}}class co{constructor(t,e,n,i){this.h=t,this.l=e,this.m=n,this.g=i,this.type="FirstParty",this.user=Hr.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(Zr(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.p.set("Authorization",t),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class lo{constructor(t,e,n,i){this.h=t,this.l=e,this.m=n,this.g=i}getToken(){return Promise.resolve(new co(this.h,this.l,this.m,this.g))}start(t,e){t.enqueueRetryable((()=>e(Hr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class uo{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ho{constructor(t){this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,e){const n=t=>{null!=t.error&&Qr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.A;return this.A=t.token,Qr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{Qr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.T.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.T.getImmediate({optional:!0});t?i(t):Qr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Zr("string"==typeof t.token),this.A=t.token,new uo(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function fo(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class po{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const i=fo(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}}function go(t,e){return t<e?-1:t>e?1:0}function mo(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class yo{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new no(eo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new no(eo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new no(eo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new no(eo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return yo.fromMillis(Date.now())}static fromDate(t){return yo.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new yo(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?go(this.nanoseconds,t.nanoseconds):go(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class vo{constructor(t){this.timestamp=t}static fromTimestamp(t){return new vo(t)}static min(){return new vo(new yo(0,0))}static max(){return new vo(new yo(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class wo{constructor(t,e,n){void 0===e?e=0:e>t.length&&Jr(),void 0===n?n=t.length-e:n>t.length-e&&Jr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===wo.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof wo?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),s=e.get(i);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class bo extends wo{construct(t,e,n){return new bo(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new no(eo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new bo(e)}static emptyPath(){return new bo([])}}const Eo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class To extends wo{construct(t,e,n){return new To(t,e,n)}static isValidIdentifier(t){return Eo.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),To.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new To(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const s=()=>{if(0===n.length)throw new no(eo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new no(eo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new no(eo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(r=!r,i++):"."!==e||r?(n+=e,i++):(s(),i++)}if(s(),r)throw new no(eo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new To(e)}static emptyPath(){return new To([])}}class Io{constructor(t){this.path=t}static fromPath(t){return new Io(bo.fromString(t))}static fromName(t){return new Io(bo.fromString(t).popFirst(5))}static empty(){return new Io(bo.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===bo.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return bo.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Io(new bo(t.slice()))}}function So(t){return new Co(t.readTime,t.key,-1)}class Co{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Co(vo.min(),Io.empty(),-1)}static max(){return new Co(vo.max(),Io.empty(),-1)}}function Ao(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Io.comparator(t.documentKey,e.documentKey),0!==n?n:go(t.largestBatchId,e.largestBatchId))}const Do="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _o{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function No(t){if(t.code!==eo.FAILED_PRECONDITION||t.message!==Do)throw t;Qr("LocalStore","Unexpectedly lost primary lease")}class ko{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Jr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ko(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ko?e:ko.resolve(e)}catch(t){return ko.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ko.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ko.reject(e)}static resolve(t){return new ko(((e,n)=>{e(t)}))}static reject(t){return new ko(((e,n)=>{n(t)}))}static waitFor(t){return new ko(((e,n)=>{let i=0,s=0,r=!1;t.forEach((t=>{++i,t.next((()=>{++s,r&&s===i&&e()}),(t=>n(t)))})),r=!0,s===i&&e()}))}static or(t){let e=ko.resolve(!1);for(const n of t)e=e.next((t=>t?ko.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new ko(((n,i)=>{const s=t.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{r[c]=t,++o,o===s&&n(r)}),(t=>i(t)))}}))}static doWhile(t,e){return new ko(((n,i)=>{const s=()=>{!0===t()?e().next((()=>{s()}),i):n()};s()}))}}function Oo(t){return"IndexedDbTransactionError"===t.name}class Ro{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ut(t),this.ct=t=>e.writeSequenceNumber(t))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}Ro.at=-1;class Lo{constructor(t,e,n,i,s,r,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class xo{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new xo("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof xo&&t.projectId===this.projectId&&t.database===this.database}}function Mo(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Po(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Fo(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Vo(t){return null==t}function Uo(t){return 0===t&&1/t==-1/0}class Bo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class jo{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw t instanceof DOMException?new Bo("Invalid base64 string: "+t):t}}(t);return new jo(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new jo(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return go(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}jo.EMPTY_BYTE_STRING=new jo("");const $o=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qo(t){if(Zr(!!t),"string"==typeof t){let e=0;const n=$o.exec(t);if(Zr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ho(t.seconds),nanos:Ho(t.nanos)}}function Ho(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ko(t){return"string"==typeof t?jo.fromBase64String(t):jo.fromUint8Array(t)}function Go(t){const e=qo(t.mapValue.fields.__local_write_time__.timestampValue);return new yo(e.seconds,e.nanos)}const zo={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Qo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?function(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}(t)?4:ra(t)?9007199254740991:10:Jr()}function Xo(t,e){if(t===e)return!0;const n=Qo(t);if(n!==Qo(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Go(t).isEqual(Go(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=qo(t.timestampValue),i=qo(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ko(t.bytesValue).isEqual(Ko(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ho(t.geoPointValue.latitude)===Ho(e.geoPointValue.latitude)&&Ho(t.geoPointValue.longitude)===Ho(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ho(t.integerValue)===Ho(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ho(t.doubleValue),i=Ho(e.doubleValue);return n===i?Uo(n)===Uo(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return mo(t.arrayValue.values||[],e.arrayValue.values||[],Xo);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(Mo(n)!==Mo(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!Xo(n[t],i[t])))return!1;return!0}(t,e);default:return Jr()}}function Wo(t,e){return void 0!==(t.values||[]).find((t=>Xo(t,e)))}function Yo(t,e){if(t===e)return 0;const n=Qo(t),i=Qo(e);if(n!==i)return go(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return go(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ho(t.integerValue||t.doubleValue),i=Ho(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return Jo(t.timestampValue,e.timestampValue);case 4:return Jo(Go(t),Go(e));case 5:return go(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ko(t),i=Ko(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=go(n[t],i[t]);if(0!==e)return e}return go(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=go(Ho(t.latitude),Ho(e.latitude));return 0!==n?n:go(Ho(t.longitude),Ho(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=Yo(n[t],i[t]);if(e)return e}return go(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===zo.mapValue&&e===zo.mapValue)return 0;if(t===zo.mapValue)return 1;if(e===zo.mapValue)return-1;const n=t.fields||{},i=Object.keys(n),s=e.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let t=0;t<i.length&&t<r.length;++t){const e=go(i[t],r[t]);if(0!==e)return e;const o=Yo(n[i[t]],s[r[t]]);if(0!==o)return o}return go(i.length,r.length)}(t.mapValue,e.mapValue);default:throw Jr()}}function Jo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return go(t,e);const n=qo(t),i=qo(e),s=go(n.seconds,i.seconds);return 0!==s?s:go(n.nanos,i.nanos)}function Zo(t){return ta(t)}function ta(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=qo(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Ko(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Io.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=ta(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const s of e)i?i=!1:n+=",",n+=`${s}:${ta(t.fields[s])}`;return n+"}"}(t.mapValue):Jr();var e,n}function ea(t){return!!t&&"integerValue"in t}function na(t){return!!t&&"arrayValue"in t}function ia(t){return!!t&&"mapValue"in t}function sa(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Po(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=sa(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=sa(t.arrayValue.values[n]);return e}return Object.assign({},t)}function ra(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class oa{constructor(t,e){this.position=t,this.inclusive=e}}function aa(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(i=r.field.isKeyField()?Io.comparator(Io.fromName(o.referenceValue),n.key):Yo(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function ca(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Xo(t.position[n],e.position[n]))return!1;return!0}class la{}class ua extends la{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new ya(t,e,n):"array-contains"===e?new Ea(t,n):"in"===e?new Ta(t,n):"not-in"===e?new Ia(t,n):"array-contains-any"===e?new Sa(t,n):new ua(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new va(t,n):new wa(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Yo(e,this.value)):null!==e&&Qo(this.value)===Qo(e)&&this.matchesComparison(Yo(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Jr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ha extends la{constructor(t,e){super(),this.filters=t,this.op=e,this.ft=null}static create(t,e){return new ha(t,e)}matches(t){return fa(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ft||(this.ft=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ft}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.dt((t=>t.isInequality()));return null!==t?t.field:null}dt(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function fa(t){return"and"===t.op}function da(t){return function(t){for(const e of t.filters)if(e instanceof ha)return!1;return!0}(t)&&fa(t)}function pa(t){if(t instanceof ua)return t.field.canonicalString()+t.op.toString()+Zo(t.value);if(da(t))return t.filters.map((t=>pa(t))).join(",");{const e=t.filters.map((t=>pa(t))).join(",");return`${t.op}(${e})`}}function ga(t,e){return t instanceof ua?function(t,e){return e instanceof ua&&t.op===e.op&&t.field.isEqual(e.field)&&Xo(t.value,e.value)}(t,e):t instanceof ha?function(t,e){return e instanceof ha&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,i)=>t&&ga(n,e.filters[i])),!0)}(t,e):void Jr()}function ma(t){return t instanceof ua?function(t){return`${t.field.canonicalString()} ${t.op} ${Zo(t.value)}`}(t):t instanceof ha?function(t){return t.op.toString()+" {"+t.getFilters().map(ma).join(" ,")+"}"}(t):"Filter"}class ya extends ua{constructor(t,e,n){super(t,e,n),this.key=Io.fromName(n.referenceValue)}matches(t){const e=Io.comparator(t.key,this.key);return this.matchesComparison(e)}}class va extends ua{constructor(t,e){super(t,"in",e),this.keys=ba(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class wa extends ua{constructor(t,e){super(t,"not-in",e),this.keys=ba(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function ba(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Io.fromName(t.referenceValue)))}class Ea extends ua{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return na(e)&&Wo(e.arrayValue,this.value)}}class Ta extends ua{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Wo(this.value.arrayValue,e)}}class Ia extends ua{constructor(t,e){super(t,"not-in",e)}matches(t){if(Wo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Wo(this.value.arrayValue,e)}}class Sa extends ua{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!na(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Wo(this.value.arrayValue,t)))}}class Ca{constructor(t,e="asc"){this.field=t,this.dir=e}}function Aa(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Da{constructor(t,e){this.comparator=t,this.root=e||Na.EMPTY}insert(t,e){return new Da(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Na.BLACK,null,null))}remove(t){return new Da(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Na.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new _a(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new _a(this.root,t,this.comparator,!1)}getReverseIterator(){return new _a(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new _a(this.root,t,this.comparator,!0)}}class _a{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Na{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:Na.RED,this.left=null!=i?i:Na.EMPTY,this.right=null!=s?s:Na.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new Na(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Na.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Na.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Na.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Na.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Jr();if(this.right.isRed())throw Jr();const t=this.left.check();if(t!==this.right.check())throw Jr();return t+(this.isRed()?0:1)}}Na.EMPTY=null,Na.RED=!0,Na.BLACK=!1,Na.EMPTY=new class{constructor(){this.size=0}get key(){throw Jr()}get value(){throw Jr()}get color(){throw Jr()}get left(){throw Jr()}get right(){throw Jr()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Na(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ka{constructor(t){this.comparator=t,this.data=new Da(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Oa(this.data.getIterator())}getIteratorFrom(t){return new Oa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof ka))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ka(this.comparator);return e.data=t,e}}class Oa{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ra{constructor(t){this.fields=t,t.sort(To.comparator)}static empty(){return new Ra([])}unionWith(t){let e=new ka(To.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ra(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return mo(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class La{constructor(t){this.value=t}static empty(){return new La({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ia(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=sa(e)}setAll(t){let e=To.emptyPath(),n={},i=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=s.popLast()}t?n[s.lastSegment()]=sa(t):i.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());ia(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Xo(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];ia(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Po(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new La(sa(this.value))}}function xa(t){const e=[];return Po(t.fields,((t,n)=>{const i=new To([t]);if(ia(n)){const t=xa(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)})),new Ra(e)}class Ma{constructor(t,e,n,i,s,r,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=o}static newInvalidDocument(t){return new Ma(t,0,vo.min(),vo.min(),vo.min(),La.empty(),0)}static newFoundDocument(t,e,n,i){return new Ma(t,1,e,vo.min(),n,i,0)}static newNoDocument(t,e){return new Ma(t,2,e,vo.min(),vo.min(),La.empty(),0)}static newUnknownDocument(t,e){return new Ma(t,3,e,vo.min(),vo.min(),La.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(vo.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=La.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=La.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=vo.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ma&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Ma(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Pa{constructor(t,e=null,n=[],i=[],s=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this._t=null}}function Fa(t,e=null,n=[],i=[],s=null,r=null,o=null){return new Pa(t,e,n,i,s,r,o)}function Va(t){const e=to(t);if(null===e._t){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>pa(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Vo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Zo(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Zo(t))).join(",")),e._t=t}return e._t}function Ua(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Aa(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ga(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ca(t.startAt,e.startAt)&&ca(t.endAt,e.endAt)}class Ba{constructor(t,e=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.wt=null,this.gt=null,this.startAt,this.endAt}}function ja(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function $a(t){const e=to(t);if(null===e.wt){e.wt=[];const t=function(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new Ca(t)),e.wt.push(new Ca(To.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Ca(To.keyField(),t))}}}return e.wt}function qa(t){const e=to(t);if(!e.gt)if("F"===e.limitType)e.gt=Fa(e.path,e.collectionGroup,$a(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of $a(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Ca(n.field,e))}const n=e.endAt?new oa(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new oa(e.startAt.position,e.startAt.inclusive):null;e.gt=Fa(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.gt}function Ha(t,e,n){return new Ba(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ka(t,e){return Ua(qa(t),qa(e))&&t.limitType===e.limitType}function Ga(t){return`${Va(qa(t))}|lt:${t.limitType}`}function za(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>ma(t))).join(", ")}]`),Vo(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Zo(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Zo(t))).join(",")),`Target(${e})`}(qa(t))}; limitType=${t.limitType})`}function Qa(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Io.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of $a(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=aa(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,$a(t),e)||t.endAt&&!function(t,e,n){const i=aa(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,$a(t),e))}(t,e)}function Xa(t,e,n){const i=t.field.isKeyField()?Io.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),s=n.data.field(t);return null!==i&&null!==s?Yo(i,s):Jr()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Jr()}}function Wa(t,e){if(t.yt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Uo(e)?"-0":e}}function Ya(t){return{integerValue:""+t}}function Ja(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Uo(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?Ya(e):Wa(t,e)}class Za{constructor(){this._=void 0}}function tc(t,e,n){return t instanceof ic?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof sc?rc(t,e):t instanceof oc?ac(t,e):function(t,e){const n=nc(t,e),i=lc(n)+lc(t.It);return ea(n)&&ea(t.It)?Ya(i):Wa(t.Tt,i)}(t,e)}function ec(t,e,n){return t instanceof sc?rc(t,e):t instanceof oc?ac(t,e):n}function nc(t,e){return t instanceof cc?ea(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class ic extends Za{}class sc extends Za{constructor(t){super(),this.elements=t}}function rc(t,e){const n=uc(e);for(const e of t.elements)n.some((t=>Xo(t,e)))||n.push(e);return{arrayValue:{values:n}}}class oc extends Za{constructor(t){super(),this.elements=t}}function ac(t,e){let n=uc(e);for(const e of t.elements)n=n.filter((t=>!Xo(t,e)));return{arrayValue:{values:n}}}class cc extends Za{constructor(t,e){super(),this.Tt=t,this.It=e}}function lc(t){return Ho(t.integerValue||t.doubleValue)}function uc(t){return na(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class hc{constructor(t,e){this.version=t,this.transformResults=e}}class fc{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new fc}static exists(t){return new fc(void 0,t)}static updateTime(t){return new fc(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function dc(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class pc{}function gc(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Cc(t.key,fc.none()):new bc(t.key,t.data,fc.none());{const n=t.data,i=La.empty();let s=new ka(To.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),s=s.add(t)}return new Ec(t.key,i,new Ra(s.toArray()),fc.none())}}function mc(t,e,n){t instanceof bc?function(t,e,n){const i=t.value.clone(),s=Ic(t.fieldTransforms,e,n.transformResults);i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof Ec?function(t,e,n){if(!dc(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=Ic(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Tc(t)),s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function yc(t,e,n,i){return t instanceof bc?function(t,e,n,i){if(!dc(t.precondition,e))return n;const s=t.value.clone(),r=Sc(t.fieldTransforms,i,e);return s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,i):t instanceof Ec?function(t,e,n,i){if(!dc(t.precondition,e))return n;const s=Sc(t.fieldTransforms,i,e),r=e.data;return r.setAll(Tc(t)),r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return dc(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function vc(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),s=nc(i.transform,t||null);null!=s&&(null===n&&(n=La.empty()),n.set(i.field,s))}return n||null}function wc(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&mo(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof sc&&e instanceof sc||t instanceof oc&&e instanceof oc?mo(t.elements,e.elements,Xo):t instanceof cc&&e instanceof cc?Xo(t.It,e.It):t instanceof ic&&e instanceof ic}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class bc extends pc{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ec extends pc{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Tc(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function Ic(t,e,n){const i=new Map;Zr(t.length===n.length);for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,ec(o,a,n[s]))}return i}function Sc(t,e,n){const i=new Map;for(const s of t){const t=s.transform,r=n.data.field(s.field);i.set(s.field,tc(t,r,e))}return i}class Cc extends pc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ac extends pc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}var Dc,_c;(_c=Dc||(Dc={}))[_c.OK=0]="OK",_c[_c.CANCELLED=1]="CANCELLED",_c[_c.UNKNOWN=2]="UNKNOWN",_c[_c.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_c[_c.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_c[_c.NOT_FOUND=5]="NOT_FOUND",_c[_c.ALREADY_EXISTS=6]="ALREADY_EXISTS",_c[_c.PERMISSION_DENIED=7]="PERMISSION_DENIED",_c[_c.UNAUTHENTICATED=16]="UNAUTHENTICATED",_c[_c.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_c[_c.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_c[_c.ABORTED=10]="ABORTED",_c[_c.OUT_OF_RANGE=11]="OUT_OF_RANGE",_c[_c.UNIMPLEMENTED=12]="UNIMPLEMENTED",_c[_c.INTERNAL=13]="INTERNAL",_c[_c.UNAVAILABLE=14]="UNAVAILABLE",_c[_c.DATA_LOSS=15]="DATA_LOSS";class Nc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Po(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return Fo(this.inner)}size(){return this.innerSize}}const kc=new Da(Io.comparator);function Oc(){return kc}const Rc=new Da(Io.comparator);function Lc(...t){let e=Rc;for(const n of t)e=e.insert(n.key,n);return e}function xc(t){let e=Rc;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Mc(){return Fc()}function Pc(){return Fc()}function Fc(){return new Nc((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Vc=new Da(Io.comparator),Uc=new ka(Io.comparator);function Bc(...t){let e=Uc;for(const n of t)e=e.add(n);return e}const jc=new ka(go);class $c{constructor(t,e){this.databaseId=t,this.yt=e}}function qc(t,e){return t.yt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hc(t,e){return t.yt?e.toBase64():e.toUint8Array()}function Kc(t,e){return qc(t,e.toTimestamp())}function Gc(t){return Zr(!!t),vo.fromTimestamp(function(t){const e=qo(t);return new yo(e.seconds,e.nanos)}(t))}function zc(t,e){return function(t){return new bo(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Qc(t,e){return zc(t.databaseId,e.path)}function Xc(t){const e=function(t){const e=bo.fromString(t);return Zr(function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}(e)),e}(t);return 4===e.length?bo.emptyPath():function(t){return Zr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}(e)}function Wc(t,e,n){return{name:Qc(t,e),fields:n.value.mapValue.fields}}function Yc(t){let e=Xc(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){Zr(1===i);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function(t){const e=Jc(t);return e instanceof ha&&da(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Ca(Zc(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Vo(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new oa(n,e)}(n.startAt));let l=null;return n.endAt&&(l=function(t){const e=!t.before,n=t.values||[];return new oa(n,e)}(n.endAt)),function(t,e,n,i,s,r,o,a){return new Ba(t,e,n,i,s,r,o,a)}(e,s,o,r,a,"F",c,l)}function Jc(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Zc(t.unaryFilter.field);return ua.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Zc(t.unaryFilter.field);return ua.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Zc(t.unaryFilter.field);return ua.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Zc(t.unaryFilter.field);return ua.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Jr()}}(t):void 0!==t.fieldFilter?function(t){return ua.create(Zc(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Jr()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return ha.create(t.compositeFilter.filters.map((t=>Jc(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Jr()}}(t.compositeFilter.op))}(t):Jr()}function Zc(t){return To.fromServerFormat(t.fieldPath)}function tl(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}class el{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&mc(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=yc(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=yc(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Pc();return this.mutations.forEach((i=>{const s=t.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=e.has(i.key)?null:o;const a=gc(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(vo.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Bc())}isEqual(t){return this.batchId===t.batchId&&mo(this.mutations,t.mutations,((t,e)=>wc(t,e)))&&mo(this.baseMutations,t.baseMutations,((t,e)=>wc(t,e)))}}class nl{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){Zr(t.mutations.length===n.length);let i=Vc;const s=t.mutations;for(let t=0;t<s.length;t++)i=i.insert(s[t].key,n[t].version);return new nl(t,e,n,i)}}class il{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class sl{constructor(t){this.oe=t}}function rl(t){const e=Yc({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ha(e,e.limit,"L"):e}class ol{constructor(){}ae(t,e){this.he(t,e),e.le()}he(t,e){if("nullValue"in t)this.fe(e,5);else if("booleanValue"in t)this.fe(e,10),e.de(t.booleanValue?1:0);else if("integerValue"in t)this.fe(e,15),e.de(Ho(t.integerValue));else if("doubleValue"in t){const n=Ho(t.doubleValue);isNaN(n)?this.fe(e,13):(this.fe(e,15),Uo(n)?e.de(0):e.de(n))}else if("timestampValue"in t){const n=t.timestampValue;this.fe(e,20),"string"==typeof n?e._e(n):(e._e(`${n.seconds||""}`),e.de(n.nanos||0))}else if("stringValue"in t)this.we(t.stringValue,e),this.me(e);else if("bytesValue"in t)this.fe(e,30),e.ge(Ko(t.bytesValue)),this.me(e);else if("referenceValue"in t)this.ye(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.fe(e,45),e.de(n.latitude||0),e.de(n.longitude||0)}else"mapValue"in t?ra(t)?this.fe(e,Number.MAX_SAFE_INTEGER):(this.pe(t.mapValue,e),this.me(e)):"arrayValue"in t?(this.Ie(t.arrayValue,e),this.me(e)):Jr()}we(t,e){this.fe(e,25),this.Te(t,e)}Te(t,e){e._e(t)}pe(t,e){const n=t.fields||{};this.fe(e,55);for(const t of Object.keys(n))this.we(t,e),this.he(n[t],e)}Ie(t,e){const n=t.values||[];this.fe(e,50);for(const t of n)this.he(t,e)}ye(t,e){this.fe(e,37),Io.fromName(t).path.forEach((t=>{this.fe(e,60),this.Te(t,e)}))}fe(t,e){t.de(e)}me(t){t.de(2)}}ol.Ee=new ol;class al{constructor(){this.Ze=new cl}addToCollectionParentIndex(t,e){return this.Ze.add(e),ko.resolve()}getCollectionParents(t,e){return ko.resolve(this.Ze.getEntries(e))}addFieldIndex(t,e){return ko.resolve()}deleteFieldIndex(t,e){return ko.resolve()}getDocumentsMatchingTarget(t,e){return ko.resolve(null)}getIndexType(t,e){return ko.resolve(0)}getFieldIndexes(t,e){return ko.resolve([])}getNextCollectionGroupToUpdate(t){return ko.resolve(null)}getMinOffset(t,e){return ko.resolve(Co.min())}getMinOffsetFromCollectionGroup(t,e){return ko.resolve(Co.min())}updateCollectionGroup(t,e,n){return ko.resolve()}updateIndexEntries(t,e){return ko.resolve()}}class cl{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new ka(bo.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new ka(bo.comparator)).toArray()}}new Uint8Array(0);class ll{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new ll(t,ll.DEFAULT_COLLECTION_PERCENTILE,ll.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ll.DEFAULT_COLLECTION_PERCENTILE=10,ll.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ll.DEFAULT=new ll(41943040,ll.DEFAULT_COLLECTION_PERCENTILE,ll.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ll.DISABLED=new ll(-1,0,0);class ul{constructor(t){this.bn=t}next(){return this.bn+=2,this.bn}static Vn(){return new ul(0)}static Sn(){return new ul(-1)}}class hl{constructor(){this.changes=new Nc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Ma.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?ko.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class fl{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class dl{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&yc(n.mutation,t,Ra.empty(),yo.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Bc()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Bc()){const i=Mc();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=Lc();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Mc();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Bc())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let s=Oc();const r=Fc(),o=Fc();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof Ec)?s=s.insert(e.key,e):void 0!==o?(r.set(e.key,o.mutation.getFieldMask()),yc(o.mutation,e,o.mutation.getFieldMask(),yo.now())):r.set(e.key,Ra.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new fl(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Fc();let i=new Da(((t,e)=>t-e)),s=Bc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||Ra.empty();o=s.applyToLocalView(r,o),n.set(t,o);const a=(i.get(s.batchId)||Bc()).add(t);i=i.insert(s.batchId,a)}))})).next((()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,l=Pc();c.forEach((t=>{if(!s.has(t)){const i=gc(e.get(t),n.get(t));null!==i&&l.set(t,i),s=s.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,a,l))}return ko.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return Io.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):ko.resolve(Mc());let o=-1,a=s;return r.next((e=>ko.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?ko.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,Bc()))).next((t=>({batchId:o,changes:xc(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Io(e)).next((t=>{let e=Lc();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let s=Lc();return this.indexManager.getCollectionParents(t,i).next((r=>ko.forEach(r,(r=>{const o=function(t,e){return new Ba(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i)))).next((t=>{i.forEach(((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,Ma.newInvalidDocument(i)))}));let n=Lc();return t.forEach(((t,s)=>{const r=i.get(t);void 0!==r&&yc(r.mutation,s,Ra.empty(),yo.now()),Qa(e,s)&&(n=n.insert(t,s))})),n}))}}class pl{constructor(t){this.Tt=t,this.es=new Map,this.ns=new Map}getBundleMetadata(t,e){return ko.resolve(this.es.get(e))}saveBundleMetadata(t,e){var n;return this.es.set(e.id,{id:(n=e).id,version:n.version,createTime:Gc(n.createTime)}),ko.resolve()}getNamedQuery(t,e){return ko.resolve(this.ns.get(e))}saveNamedQuery(t,e){return this.ns.set(e.name,function(t){return{name:t.name,query:rl(t.bundledQuery),readTime:Gc(t.readTime)}}(e)),ko.resolve()}}class gl{constructor(){this.overlays=new Da(Io.comparator),this.ss=new Map}getOverlay(t,e){return ko.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Mc();return ko.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.ce(t,e,i)})),ko.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.ss.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.ss.delete(n)),ko.resolve()}getOverlaysForCollection(t,e,n){const i=Mc(),s=e.length+1,r=new Io(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===s&&t.largestBatchId>n&&i.set(t.getKey(),t)}return ko.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new Da(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Mc(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Mc(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return ko.resolve(o)}ce(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.ss.get(i.largestBatchId).delete(n.key);this.ss.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new il(e,n));let s=this.ss.get(e);void 0===s&&(s=Bc(),this.ss.set(e,s)),this.ss.set(e,s.add(n.key))}}class ml{constructor(){this.rs=new ka(yl.os),this.us=new ka(yl.cs)}isEmpty(){return this.rs.isEmpty()}addReference(t,e){const n=new yl(t,e);this.rs=this.rs.add(n),this.us=this.us.add(n)}hs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ls(new yl(t,e))}fs(t,e){t.forEach((t=>this.removeReference(t,e)))}ds(t){const e=new Io(new bo([])),n=new yl(e,t),i=new yl(e,t+1),s=[];return this.us.forEachInRange([n,i],(t=>{this.ls(t),s.push(t.key)})),s}_s(){this.rs.forEach((t=>this.ls(t)))}ls(t){this.rs=this.rs.delete(t),this.us=this.us.delete(t)}ws(t){const e=new Io(new bo([])),n=new yl(e,t),i=new yl(e,t+1);let s=Bc();return this.us.forEachInRange([n,i],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new yl(t,0),n=this.rs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class yl{constructor(t,e){this.key=t,this.gs=e}static os(t,e){return Io.comparator(t.key,e.key)||go(t.gs,e.gs)}static cs(t,e){return go(t.gs,e.gs)||Io.comparator(t.key,e.key)}}class vl{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.ys=1,this.ps=new ka(yl.os)}checkEmpty(t){return ko.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const s=this.ys;this.ys++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new el(s,e,n,i);this.mutationQueue.push(r);for(const e of i)this.ps=this.ps.add(new yl(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return ko.resolve(r)}lookupMutationBatch(t,e){return ko.resolve(this.Is(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.Ts(n),s=i<0?0:i;return ko.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ko.resolve(0===this.mutationQueue.length?-1:this.ys-1)}getAllMutationBatches(t){return ko.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new yl(e,0),i=new yl(e,Number.POSITIVE_INFINITY),s=[];return this.ps.forEachInRange([n,i],(t=>{const e=this.Is(t.gs);s.push(e)})),ko.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new ka(go);return e.forEach((t=>{const e=new yl(t,0),i=new yl(t,Number.POSITIVE_INFINITY);this.ps.forEachInRange([e,i],(t=>{n=n.add(t.gs)}))})),ko.resolve(this.Es(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;Io.isDocumentKey(s)||(s=s.child(""));const r=new yl(new Io(s),0);let o=new ka(go);return this.ps.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.gs)),!0)}),r),ko.resolve(this.Es(o))}Es(t){const e=[];return t.forEach((t=>{const n=this.Is(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Zr(0===this.As(e.batchId,"removed")),this.mutationQueue.shift();let n=this.ps;return ko.forEach(e.mutations,(i=>{const s=new yl(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.ps=n}))}Pn(t){}containsKey(t,e){const n=new yl(e,0),i=this.ps.firstAfterOrEqual(n);return ko.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,ko.resolve()}As(t,e){return this.Ts(t)}Ts(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Is(t){const e=this.Ts(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class wl{constructor(t){this.Rs=t,this.docs=new Da(Io.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),s=i?i.size:0,r=this.Rs(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ko.resolve(n?n.document.mutableCopy():Ma.newInvalidDocument(e))}getEntries(t,e){let n=Oc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Ma.newInvalidDocument(t))})),ko.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Oc();const r=e.path,o=new Io(r.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!r.isPrefixOf(t.path))break;t.path.length>r.length+1||Ao(So(o),n)<=0||(i.has(o.key)||Qa(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return ko.resolve(s)}getAllFromCollectionGroup(t,e,n,i){Jr()}Ps(t,e){return ko.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new bl(this)}getSize(t){return ko.resolve(this.size)}}class bl extends hl{constructor(t){super(),this.Xn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.Xn.addEntry(t,i)):this.Xn.removeEntry(n)})),ko.waitFor(e)}getFromCache(t,e){return this.Xn.getEntry(t,e)}getAllFromCache(t,e){return this.Xn.getEntries(t,e)}}class El{constructor(t){this.persistence=t,this.vs=new Nc((t=>Va(t)),Ua),this.lastRemoteSnapshotVersion=vo.min(),this.highestTargetId=0,this.bs=0,this.Vs=new ml,this.targetCount=0,this.Ss=ul.Vn()}forEachTarget(t,e){return this.vs.forEach(((t,n)=>e(n))),ko.resolve()}getLastRemoteSnapshotVersion(t){return ko.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ko.resolve(this.bs)}allocateTargetId(t){return this.highestTargetId=this.Ss.next(),ko.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.bs&&(this.bs=e),ko.resolve()}xn(t){this.vs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ss=new ul(e),this.highestTargetId=e),t.sequenceNumber>this.bs&&(this.bs=t.sequenceNumber)}addTargetData(t,e){return this.xn(e),this.targetCount+=1,ko.resolve()}updateTargetData(t,e){return this.xn(e),ko.resolve()}removeTargetData(t,e){return this.vs.delete(e.target),this.Vs.ds(e.targetId),this.targetCount-=1,ko.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.vs.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.vs.delete(r),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),ko.waitFor(s).next((()=>i))}getTargetCount(t){return ko.resolve(this.targetCount)}getTargetData(t,e){const n=this.vs.get(e)||null;return ko.resolve(n)}addMatchingKeys(t,e,n){return this.Vs.hs(e,n),ko.resolve()}removeMatchingKeys(t,e,n){this.Vs.fs(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach((e=>{s.push(i.markPotentiallyOrphaned(t,e))})),ko.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Vs.ds(e),ko.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Vs.ws(e);return ko.resolve(n)}containsKey(t,e){return ko.resolve(this.Vs.containsKey(e))}}class Tl{constructor(t,e){this.Ds={},this.overlays={},this.Cs=new Ro(0),this.xs=!1,this.xs=!0,this.referenceDelegate=t(this),this.Ns=new El(this),this.indexManager=new al,this.remoteDocumentCache=function(t){return new wl(t)}((t=>this.referenceDelegate.ks(t))),this.Tt=new sl(e),this.$s=new pl(this.Tt)}start(){return Promise.resolve()}shutdown(){return this.xs=!1,Promise.resolve()}get started(){return this.xs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new gl,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Ds[t.toKey()];return n||(n=new vl(e,this.referenceDelegate),this.Ds[t.toKey()]=n),n}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$s}runTransaction(t,e,n){Qr("MemoryPersistence","Starting transaction:",t);const i=new Il(this.Cs.next());return this.referenceDelegate.Ms(),n(i).next((t=>this.referenceDelegate.Os(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Fs(t,e){return ko.or(Object.values(this.Ds).map((n=>()=>n.containsKey(t,e))))}}class Il extends _o{constructor(t){super(),this.currentSequenceNumber=t}}class Sl{constructor(t){this.persistence=t,this.Bs=new ml,this.Ls=null}static qs(t){return new Sl(t)}get Us(){if(this.Ls)return this.Ls;throw Jr()}addReference(t,e,n){return this.Bs.addReference(n,e),this.Us.delete(n.toString()),ko.resolve()}removeReference(t,e,n){return this.Bs.removeReference(n,e),this.Us.add(n.toString()),ko.resolve()}markPotentiallyOrphaned(t,e){return this.Us.add(e.toString()),ko.resolve()}removeTarget(t,e){this.Bs.ds(e.targetId).forEach((t=>this.Us.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Us.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ms(){this.Ls=new Set}Os(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ko.forEach(this.Us,(n=>{const i=Io.fromPath(n);return this.Ks(t,i).next((t=>{t||e.removeEntry(i,vo.min())}))})).next((()=>(this.Ls=null,e.apply(t))))}updateLimboDocument(t,e){return this.Ks(t,e).next((t=>{t?this.Us.delete(e.toString()):this.Us.add(e.toString())}))}ks(t){return 0}Ks(t,e){return ko.or([()=>ko.resolve(this.Bs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Fs(t,e)])}}class Cl{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Ci=n,this.xi=i}static Ni(t,e){let n=Bc(),i=Bc();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new Cl(t,e.fromCache,n,i)}}class Al{constructor(){this.ki=!1}initialize(t,e){this.$i=t,this.indexManager=e,this.ki=!0}getDocumentsMatchingQuery(t,e,n,i){return this.Mi(t,e).next((s=>s||this.Oi(t,e,i,n))).next((n=>n||this.Fi(t,e)))}Mi(t,e){if(ja(e))return ko.resolve(null);let n=qa(e);return this.indexManager.getIndexType(t,n).next((i=>0===i?null:(null!==e.limit&&1===i&&(e=Ha(e,null,"F"),n=qa(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const s=Bc(...i);return this.$i.getDocuments(t,s).next((i=>this.indexManager.getMinOffset(t,n).next((n=>{const r=this.Bi(e,i);return this.Li(e,r,s,n.readTime)?this.Mi(t,Ha(e,null,"F")):this.qi(t,r,e,n)}))))})))))}Oi(t,e,n,i){return ja(e)||i.isEqual(vo.min())?this.Fi(t,e):this.$i.getDocuments(t,n).next((s=>{const r=this.Bi(e,s);return this.Li(e,r,n,i)?this.Fi(t,e):(zr()<=A.DEBUG&&Qr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),za(e)),this.qi(t,r,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,s=vo.fromTimestamp(1e9===i?new yo(n+1,0):new yo(n,i));return new Co(s,Io.empty(),e)}(i,-1)))}))}Bi(t,e){let n=new ka(function(t){return(e,n)=>{let i=!1;for(const s of $a(t)){const t=Xa(s,e,n);if(0!==t)return t;i=i||s.field.isKeyField()}return 0}}(t));return e.forEach(((e,i)=>{Qa(t,i)&&(n=n.add(i))})),n}Li(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Fi(t,e){return zr()<=A.DEBUG&&Qr("QueryEngine","Using full collection scan to execute query:",za(e)),this.$i.getDocumentsMatchingQuery(t,e,Co.min())}qi(t,e,n,i){return this.$i.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Dl{constructor(t,e,n,i){this.persistence=t,this.Ui=e,this.Tt=i,this.Ki=new Da(go),this.Gi=new Nc((t=>Va(t)),Ua),this.Qi=new Map,this.ji=t.getRemoteDocumentCache(),this.Ns=t.getTargetCache(),this.$s=t.getBundleCache(),this.zi(n)}zi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new dl(this.ji,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ji.setIndexManager(this.indexManager),this.Ui.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ki)))}}async function _l(t,e){const n=to(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((s=>(i=s,n.zi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],r=[];let o=Bc();for(const t of i){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Wi:t,removedBatchIds:s,addedBatchIds:r})))}))}))}function Nl(t,e){const n=to(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}class kl{constructor(){this.activeTargetIds=jc}sr(t){this.activeTargetIds=this.activeTargetIds.add(t)}ir(t){this.activeTargetIds=this.activeTargetIds.delete(t)}nr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ol{constructor(){this.Ur=new kl,this.Kr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Ur.sr(t),this.Kr[t]||"not-current"}updateQueryState(t,e,n){this.Kr[t]=e}removeLocalQueryTarget(t){this.Ur.ir(t)}isLocalQueryTarget(t){return this.Ur.activeTargetIds.has(t)}clearQueryState(t){delete this.Kr[t]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(t){return this.Ur.activeTargetIds.has(t)}start(){return this.Ur=new kl,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Rl{Gr(t){}shutdown(){}}class Ll{constructor(){this.Qr=()=>this.jr(),this.zr=()=>this.Wr(),this.Hr=[],this.Jr()}Gr(t){this.Hr.push(t)}shutdown(){window.removeEventListener("online",this.Qr),window.removeEventListener("offline",this.zr)}Jr(){window.addEventListener("online",this.Qr),window.addEventListener("offline",this.zr)}jr(){Qr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Hr)t(0)}Wr(){Qr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Hr)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let xl=null;function Ml(){return null===xl?xl=268435456+Math.round(2147483648*Math.random()):xl++,"0x"+xl.toString(16)}const Pl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Fl{constructor(t){this.Yr=t.Yr,this.Zr=t.Zr}Xr(t){this.eo=t}no(t){this.so=t}onMessage(t){this.io=t}close(){this.Zr()}send(t){this.Yr(t)}ro(){this.eo()}oo(t){this.so(t)}uo(t){this.io(t)}}const Vl="WebChannelConnection";class Ul extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.co=e+"://"+t.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get ho(){return!1}lo(t,e,n,i,s){const r=Ml(),o=this.fo(t,e);Qr("RestConnection",`Sending RPC '${t}' ${r}:`,o,n);const a={};return this._o(a,i,s),this.wo(t,o,a,n).then((e=>(Qr("RestConnection",`Received RPC '${t}' ${r}: `,e),e)),(e=>{throw Wr("RestConnection",`RPC '${t}' ${r} failed with error: `,e,"url: ",o,"request:",n),e}))}mo(t,e,n,i,s,r){return this.lo(t,e,n,i,s)}_o(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Kr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}fo(t,e){const n=Pl[t];return`${this.co}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}wo(t,e,n,i){const s=Ml();return new Promise(((r,o)=>{const a=new $r;a.setWithCredentials(!0),a.listenOnce(Fr.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Pr.NO_ERROR:const e=a.getResponseJson();Qr(Vl,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),r(e);break;case Pr.TIMEOUT:Qr(Vl,`RPC '${t}' ${s} timed out`),o(new no(eo.DEADLINE_EXCEEDED,"Request time out"));break;case Pr.HTTP_ERROR:const n=a.getStatus();if(Qr(Vl,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(eo).indexOf(e)>=0?e:eo.UNKNOWN}(e.status);o(new no(t,e.message))}else o(new no(eo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new no(eo.UNAVAILABLE,"Connection failed."));break;default:Jr()}}finally{Qr(Vl,`RPC '${t}' ${s} completed.`)}}));const c=JSON.stringify(i);Qr(Vl,`RPC '${t}' ${s} sending request:`,i),a.send(e,"POST",c,n,15)}))}yo(t,e,n){const i=Ml(),s=[this.co,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=xr(),o=Mr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Br({})),this._o(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const c=s.join("");Qr(Vl,`Creating RPC '${t}' stream ${i}: ${c}`,a);const l=r.createWebChannel(c,a);let u=!1,h=!1;const f=new Fl({Yr:e=>{h?Qr(Vl,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(u||(Qr(Vl,`Opening RPC '${t}' stream ${i} transport.`),l.open(),u=!0),Qr(Vl,`RPC '${t}' stream ${i} sending:`,e),l.send(e))},Zr:()=>l.close()}),d=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return d(l,jr.EventType.OPEN,(()=>{h||Qr(Vl,`RPC '${t}' stream ${i} transport opened.`)})),d(l,jr.EventType.CLOSE,(()=>{h||(h=!0,Qr(Vl,`RPC '${t}' stream ${i} transport closed`),f.oo())})),d(l,jr.EventType.ERROR,(e=>{h||(h=!0,Wr(Vl,`RPC '${t}' stream ${i} transport errored:`,e),f.oo(new no(eo.UNAVAILABLE,"The operation could not be completed")))})),d(l,jr.EventType.MESSAGE,(e=>{var n;if(!h){const s=e.data[0];Zr(!!s);const r=s,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){Qr(Vl,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=Dc[t];if(void 0!==e)return function(t){if(void 0===t)return Xr("GRPC error has no .code"),eo.UNKNOWN;switch(t){case Dc.OK:return eo.OK;case Dc.CANCELLED:return eo.CANCELLED;case Dc.UNKNOWN:return eo.UNKNOWN;case Dc.DEADLINE_EXCEEDED:return eo.DEADLINE_EXCEEDED;case Dc.RESOURCE_EXHAUSTED:return eo.RESOURCE_EXHAUSTED;case Dc.INTERNAL:return eo.INTERNAL;case Dc.UNAVAILABLE:return eo.UNAVAILABLE;case Dc.UNAUTHENTICATED:return eo.UNAUTHENTICATED;case Dc.INVALID_ARGUMENT:return eo.INVALID_ARGUMENT;case Dc.NOT_FOUND:return eo.NOT_FOUND;case Dc.ALREADY_EXISTS:return eo.ALREADY_EXISTS;case Dc.PERMISSION_DENIED:return eo.PERMISSION_DENIED;case Dc.FAILED_PRECONDITION:return eo.FAILED_PRECONDITION;case Dc.ABORTED:return eo.ABORTED;case Dc.OUT_OF_RANGE:return eo.OUT_OF_RANGE;case Dc.UNIMPLEMENTED:return eo.UNIMPLEMENTED;case Dc.DATA_LOSS:return eo.DATA_LOSS;default:return Jr()}}(e)}(e),s=o.message;void 0===n&&(n=eo.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),h=!0,f.oo(new no(n,s)),l.close()}else Qr(Vl,`RPC '${t}' stream ${i} received:`,s),f.uo(s)}})),d(o,Vr.STAT_EVENT,(e=>{e.stat===Ur.PROXY?Qr(Vl,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===Ur.NOPROXY&&Qr(Vl,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.ro()}),0),f}}function Bl(){return"undefined"!=typeof document?document:null}function jl(t){return new $c(t,!0)}class $l{constructor(t,e,n=1e3,i=1.5,s=6e4){this.Ys=t,this.timerId=e,this.po=n,this.Io=i,this.To=s,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}Po(){this.Eo=this.To}vo(t){this.cancel();const e=Math.floor(this.Eo+this.bo()),n=Math.max(0,Date.now()-this.Ro),i=Math.max(0,e-n);i>0&&Qr("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Eo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,i,(()=>(this.Ro=Date.now(),t()))),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){null!==this.Ao&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){null!==this.Ao&&(this.Ao.cancel(),this.Ao=null)}bo(){return(Math.random()-.5)*this.Eo}}class ql{constructor(t,e,n,i,s,r,o,a){this.Ys=t,this.So=n,this.Do=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Co=0,this.xo=null,this.No=null,this.stream=null,this.ko=new $l(t,e)}$o(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.$o()&&await this.close(0)}Fo(){this.state=0,this.ko.reset()}Bo(){this.Mo()&&null===this.xo&&(this.xo=this.Ys.enqueueAfterDelay(this.So,6e4,(()=>this.Lo())))}qo(t){this.Uo(),this.stream.send(t)}async Lo(){if(this.Mo())return this.close(0)}Uo(){this.xo&&(this.xo.cancel(),this.xo=null)}Ko(){this.No&&(this.No.cancel(),this.No=null)}async close(t,e){this.Uo(),this.Ko(),this.ko.cancel(),this.Co++,4!==t?this.ko.reset():e&&e.code===eo.RESOURCE_EXHAUSTED?(Xr(e.toString()),Xr("Using maximum backoff delay to prevent overloading the backend."),this.ko.Po()):e&&e.code===eo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Go(),this.stream.close(),this.stream=null),this.state=t,await this.listener.no(e)}Go(){}auth(){this.state=1;const t=this.Qo(this.Co),e=this.Co;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Co===e&&this.jo(t,n)}),(e=>{t((()=>{const t=new no(eo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.zo(t)}))}))}jo(t,e){const n=this.Qo(this.Co);this.stream=this.Wo(t,e),this.stream.Xr((()=>{n((()=>(this.state=2,this.No=this.Ys.enqueueAfterDelay(this.Do,1e4,(()=>(this.Mo()&&(this.state=3),Promise.resolve()))),this.listener.Xr())))})),this.stream.no((t=>{n((()=>this.zo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Oo(){this.state=5,this.ko.vo((async()=>{this.state=0,this.start()}))}zo(t){return Qr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Qo(t){return e=>{this.Ys.enqueueAndForget((()=>this.Co===t?e():(Qr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Hl extends ql{constructor(t,e,n,i,s,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,r),this.Tt=s,this.Zo=!1}get Xo(){return this.Zo}start(){this.Zo=!1,this.lastStreamToken=void 0,super.start()}Go(){this.Zo&&this.tu([])}Wo(t,e){return this.connection.yo("Write",t,e)}onMessage(t){if(Zr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Zo){this.ko.reset();const e=function(t,e){return t&&t.length>0?(Zr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Gc(t.updateTime):Gc(e);return n.isEqual(vo.min())&&(n=Gc(e)),new hc(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Gc(t.commitTime);return this.listener.eu(n,e)}return Zr(!t.writeResults||0===t.writeResults.length),this.Zo=!0,this.listener.nu()}su(){const t={};t.database=function(t){return new bo(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}(this.Tt),this.qo(t)}tu(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof bc)n={update:Wc(t,e.key,e.value)};else if(e instanceof Cc)n={delete:Qc(t,e.key)};else if(e instanceof Ec)n={update:Wc(t,e.key,e.data),updateMask:tl(e.fieldMask)};else{if(!(e instanceof Ac))return Jr();n={verify:Qc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof ic)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof sc)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof oc)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof cc)return{fieldPath:e.field.canonicalString(),increment:n.It};throw Jr()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Kc(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Jr()}(t,e.precondition)),n}(this.Tt,t)))};this.qo(e)}}class Kl extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.Tt=i,this.iu=!1}ru(){if(this.iu)throw new no(eo.FAILED_PRECONDITION,"The client has already been terminated.")}lo(t,e,n){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.lo(t,e,n,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===eo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new no(eo.UNKNOWN,t.toString())}))}mo(t,e,n,i){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.mo(t,e,n,s,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===eo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new no(eo.UNKNOWN,t.toString())}))}terminate(){this.iu=!0}}class Gl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.ou=0,this.uu=null,this.cu=!0}au(){0===this.ou&&(this.hu("Unknown"),this.uu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.uu=null,this.lu("Backend didn't respond within 10 seconds."),this.hu("Offline"),Promise.resolve()))))}fu(t){"Online"===this.state?this.hu("Unknown"):(this.ou++,this.ou>=1&&(this.du(),this.lu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.hu("Offline")))}set(t){this.du(),this.ou=0,"Online"===t&&(this.cu=!1),this.hu(t)}hu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}lu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.cu?(Xr(e),this.cu=!1):Qr("OnlineStateTracker",e)}du(){null!==this.uu&&(this.uu.cancel(),this.uu=null)}}class zl{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this._u=[],this.wu=new Map,this.mu=new Set,this.gu=[],this.yu=s,this.yu.Gr((t=>{n.enqueueAndForget((async()=>{Wl(this)&&(Qr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=to(t);e.mu.add(4),await Xl(e),e.pu.set("Unknown"),e.mu.delete(4),await Ql(e)}(this))}))})),this.pu=new Gl(n,i)}}async function Ql(t){if(Wl(t))for(const e of t.gu)await e(!0)}async function Xl(t){for(const e of t.gu)await e(!1)}function Wl(t){return 0===to(t).mu.size}async function Yl(t,e,n){if(!Oo(e))throw e;t.mu.add(1),await Xl(t),t.pu.set("Offline"),n||(n=()=>function(t){const e=to(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ns.getLastRemoteSnapshotVersion(t)))}(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Qr("RemoteStore","Retrying IndexedDB access"),await n(),t.mu.delete(1),await Ql(t)}))}function Jl(t,e){return e().catch((n=>Yl(t,n,e)))}async function Zl(t){const e=to(t),n=lu(e);let i=e._u.length>0?e._u[e._u.length-1].batchId:-1;for(;tu(e);)try{const t=await Nl(e.localStore,i);if(null===t){0===e._u.length&&n.Bo();break}i=t.batchId,eu(e,t)}catch(t){await Yl(e,t)}nu(e)&&iu(e)}function tu(t){return Wl(t)&&t._u.length<10}function eu(t,e){t._u.push(e);const n=lu(t);n.Mo()&&n.Xo&&n.tu(e.mutations)}function nu(t){return Wl(t)&&!lu(t).$o()&&t._u.length>0}function iu(t){lu(t).start()}async function su(t){lu(t).su()}async function ru(t){const e=lu(t);for(const n of t._u)e.tu(n.mutations)}async function ou(t,e,n){const i=t._u.shift(),s=nl.from(i,e,n);await Jl(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Zl(t)}async function au(t,e){e&&lu(t).Xo&&await async function(t,e){if(function(t){switch(t){default:return Jr();case eo.CANCELLED:case eo.UNKNOWN:case eo.DEADLINE_EXCEEDED:case eo.RESOURCE_EXHAUSTED:case eo.INTERNAL:case eo.UNAVAILABLE:case eo.UNAUTHENTICATED:return!1;case eo.INVALID_ARGUMENT:case eo.NOT_FOUND:case eo.ALREADY_EXISTS:case eo.PERMISSION_DENIED:case eo.FAILED_PRECONDITION:case eo.ABORTED:case eo.OUT_OF_RANGE:case eo.UNIMPLEMENTED:case eo.DATA_LOSS:return!0}}(n=e.code)&&n!==eo.ABORTED){const n=t._u.shift();lu(t).Fo(),await Jl(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Zl(t)}var n}(t,e),nu(t)&&iu(t)}async function cu(t,e){const n=to(t);n.asyncQueue.verifyOperationInProgress(),Qr("RemoteStore","RemoteStore received new credentials");const i=Wl(n);n.mu.add(3),await Xl(n),i&&n.pu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.mu.delete(3),await Ql(n)}function lu(t){return t.Eu||(t.Eu=function(t,e,n){const i=to(t);return i.ru(),new Hl(e,i.connection,i.authCredentials,i.appCheckCredentials,i.Tt,n)}(t.datastore,t.asyncQueue,{Xr:su.bind(null,t),no:au.bind(null,t),nu:ru.bind(null,t),eu:ou.bind(null,t)}),t.gu.push((async e=>{e?(t.Eu.Fo(),await Zl(t)):(await t.Eu.stop(),t._u.length>0&&(Qr("RemoteStore",`Stopping write stream with ${t._u.length} pending writes`),t._u=[]))}))),t.Eu}class uu{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new io,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new uu(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new no(eo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hu(t,e){if(Xr("AsyncQueue",`${e}: ${t}`),Oo(t))return new no(eo.UNAVAILABLE,`${e}: ${t}`);throw t}class fu{constructor(){this.queries=new Nc((t=>Ga(t)),Ka),this.onlineState="Unknown",this.vu=new Set}}class du{constructor(t,e,n,i,s,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.rc={},this.oc=new Nc((t=>Ga(t)),Ka),this.uc=new Map,this.cc=new Set,this.ac=new Da(Io.comparator),this.hc=new Map,this.lc=new ml,this.fc={},this.dc=new Map,this._c=ul.Sn(),this.onlineState="Unknown",this.wc=void 0}get isPrimaryClient(){return!0===this.wc}}function pu(t,e,n){const i=to(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.oc.forEach(((n,i)=>{const s=i.view.bu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=to(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.bu(e)&&(i=!0)})),i&&function(t){t.vu.forEach((t=>{t.next()}))}(n)}(i.eventManager,e),t.length&&i.rc.Ho(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function gu(t,e){const n=to(t),i=e.batch.batchId;try{const t=await function(t,e){const n=to(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const i=e.batch.keys(),s=n.ji.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const s=n.batch,r=s.keys();let o=ko.resolve();return r.forEach((t=>{o=o.next((()=>i.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);Zr(null!==r),e.version.compareTo(r)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),i.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Bc();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(n.localStore,e);vu(n,i,null),yu(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await wu(n,t)}catch(t){await No(t)}}async function mu(t,e,n){const i=to(t);try{const t=await function(t,e){const n=to(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let i;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Zr(null!==e),i=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,i))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(i.localStore,e);vu(i,e,n),yu(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await wu(i,t)}catch(n){await No(n)}}function yu(t,e){(t.dc.get(e)||[]).forEach((t=>{t.resolve()})),t.dc.delete(e)}function vu(t,e,n){const i=to(t);let s=i.fc[i.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),i.fc[i.currentUser.toKey()]=s}}async function wu(t,e,n){const i=to(t),s=[],r=[],o=[];i.oc.isEmpty()||(i.oc.forEach(((t,a)=>{o.push(i.mc(a,e,n).then((t=>{if((t||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Cl.Ni(a.targetId,t);r.push(e)}})))})),await Promise.all(o),i.rc.Ho(s),await async function(t,e){const n=to(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>ko.forEach(e,(e=>ko.forEach(e.Ci,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>ko.forEach(e.xi,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!Oo(t))throw t;Qr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ki.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.Ki=n.Ki.insert(e,s)}}}(i.localStore,r))}async function bu(t,e){const n=to(t);if(!n.currentUser.isEqual(e)){Qr("SyncEngine","User change. New user:",e.toKey());const t=await _l(n.localStore,e);n.currentUser=e,function(t,e){t.dc.forEach((t=>{t.forEach((t=>{t.reject(new no(eo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.dc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await wu(n,t.Wi)}}function Eu(t){const e=to(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=gu.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mu.bind(null,e),e}class Tu{constructor(){this.synchronizeTabs=!1}async initialize(t){this.Tt=jl(t.databaseInfo.databaseId),this.sharedClientState=this.Ic(t),this.persistence=this.Tc(t),await this.persistence.start(),this.localStore=this.Ec(t),this.gcScheduler=this.Ac(t,this.localStore),this.indexBackfillerScheduler=this.Rc(t,this.localStore)}Ac(t,e){return null}Rc(t,e){return null}Ec(t){return function(t,e,n,i){return new Dl(t,e,n,i)}(this.persistence,new Al,t.initialUser,this.Tt)}Tc(t){return new Tl(Sl.qs,this.Tt)}Ic(t){return new Ol}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Iu{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>pu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=bu.bind(null,this.syncEngine),await async function(t,e){const n=to(t);e?(n.mu.delete(2),await Ql(n)):e||(n.mu.add(2),await Xl(n),n.pu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new fu}createDatastore(t){const e=jl(t.databaseInfo.databaseId),n=(i=t.databaseInfo,new Ul(i));var i;return function(t,e,n,i){return new Kl(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,i=t.asyncQueue,s=t=>pu(this.syncEngine,t,0),r=Ll.C()?new Ll:new Rl,new zl(e,n,i,s,r);var e,n,i,s,r}createSyncEngine(t,e){return function(t,e,n,i,s,r,o){const a=new du(t,e,n,i,s,r);return o&&(a.wc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=to(t);Qr("RemoteStore","RemoteStore shutting down."),e.mu.add(5),await Xl(e),e.yu.shutdown(),e.pu.set("Unknown")}(this.remoteStore)}}class Su{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Hr.UNAUTHENTICATED,this.clientId=po.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Qr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Qr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new no(eo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new io;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=hu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Cu(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){return t.offlineComponents||(Qr("FirestoreClient","Using default OfflineComponentProvider"),await async function(t,e){t.asyncQueue.verifyOperationInProgress(),Qr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await _l(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}(t,new Tu)),t.offlineComponents}(t);Qr("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>cu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>cu(e.remoteStore,n))),t.onlineComponents=e}function Au(t){return async function(t){return t.onlineComponents||(Qr("FirestoreClient","Using default OnlineComponentProvider"),await Cu(t,new Iu)),t.onlineComponents}(t).then((t=>t.syncEngine))}const Du=new Map;function _u(t,e,n){if(!n)throw new no(eo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Nu(t){if(!Io.isDocumentKey(t))throw new no(eo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function ku(t){if(Io.isDocumentKey(t))throw new no(eo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Ou(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Jr()}function Ru(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new no(eo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ou(t);throw new no(eo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Lu{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new no(eo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new no(eo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,i){if(!0===e&&!0===i)throw new no(eo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class xu{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Lu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new no(eo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new no(eo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Lu(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new ro;switch(t.type){case"gapi":const e=t.client;return new lo(e,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new no(eo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Du.get(t);e&&(Qr("ComponentProvider","Removing Datastore"),Du.delete(t),e.terminate())}(this),Promise.resolve()}}function Mu(t,e,n,i={}){var r;const o=(t=Ru(t,xu))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Wr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:`${e}:${n}`,ssl:!1})),i.mockUserToken){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=Hr.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(r=t._app)||void 0===r?void 0:r.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new no(eo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Hr(o)}t._authCredentials=new oo(new so(e,n))}}class Pu{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Pu(this.firestore,t,this._key)}}class Fu{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Fu(this.firestore,t,this._query)}}class Vu extends Fu{constructor(t,e,n){super(t,e,function(t){return new Ba(t)}(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Pu(this.firestore,null,new Io(t))}withConverter(t){return new Vu(this.firestore,t,this._path)}}class Uu{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new $l(this,"async_queue_retry"),this.Hc=()=>{const t=Bl();t&&Qr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ko.Vo()};const t=Bl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Jc(),this.Yc(t)}enterRestrictedMode(t){if(!this.Kc){this.Kc=!0,this.zc=t||!1;const e=Bl();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Hc)}}enqueue(t){if(this.Jc(),this.Kc)return new Promise((()=>{}));const e=new io;return this.Yc((()=>this.Kc&&this.zc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Uc.push(t),this.Zc())))}async Zc(){if(0!==this.Uc.length){try{await this.Uc[0](),this.Uc.shift(),this.ko.reset()}catch(t){if(!Oo(t))throw t;Qr("AsyncQueue","Operation failed with retryable error: "+t)}this.Uc.length>0&&this.ko.vo((()=>this.Zc()))}}Yc(t){const e=this.qc.then((()=>(this.jc=!0,t().catch((t=>{this.Qc=t,this.jc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Xr("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.jc=!1,t))))));return this.qc=e,e}enqueueAfterDelay(t,e,n){this.Jc(),this.Wc.indexOf(t)>-1&&(e=0);const i=uu.createAndSchedule(this,t,e,n,(t=>this.Xc(t)));return this.Gc.push(i),i}Jc(){this.Qc&&Jr()}verifyOperationInProgress(){}async ta(){let t;do{t=this.qc,await t}while(t!==this.qc)}ea(t){for(const e of this.Gc)if(e.timerId===t)return!0;return!1}na(t){return this.ta().then((()=>{this.Gc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Gc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ta()}))}sa(t){this.Wc.push(t)}Xc(t){const e=this.Gc.indexOf(t);this.Gc.splice(e,1)}}class Bu extends xu{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new Uu,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||ju(this),this._firestoreClient.terminate()}}function ju(t){var e;const n=t._freezeSettings(),i=function(t,e,n,i){return new Lo(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Su(t._authCredentials,t._appCheckCredentials,t._queue,i)}class $u{constructor(t){this._byteString=t}static fromBase64String(t){try{return new $u(jo.fromBase64String(t))}catch(t){throw new no(eo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new $u(jo.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class qu{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new no(eo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new To(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Hu{constructor(t){this._methodName=t}}class Ku{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new no(eo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new no(eo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return go(this._lat,t._lat)||go(this._long,t._long)}}const Gu=/^__.*__$/;class zu{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Ec(t,this.data,this.fieldMask,e,this.fieldTransforms):new bc(t,this.data,e,this.fieldTransforms)}}function Qu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Jr()}}class Xu{constructor(t,e,n,i,s,r){this.settings=t,this.databaseId=e,this.Tt=n,this.ignoreUndefinedProperties=i,void 0===s&&this.ia(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get ra(){return this.settings.ra}oa(t){return new Xu(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.Tt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ua(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.oa({path:n,ca:!1});return i.aa(t),i}ha(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.oa({path:n,ca:!1});return i.ia(),i}la(t){return this.oa({path:void 0,ca:!0})}fa(t){return rh(t,this.settings.methodName,this.settings.da||!1,this.path,this.settings._a)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ia(){if(this.path)for(let t=0;t<this.path.length;t++)this.aa(this.path.get(t))}aa(t){if(0===t.length)throw this.fa("Document fields must not be empty");if(Qu(this.ra)&&Gu.test(t))throw this.fa('Document fields cannot begin and end with "__"')}}class Wu{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.Tt=n||jl(t)}wa(t,e,n,i=!1){return new Xu({ra:t,methodName:e,_a:n,path:To.emptyPath(),ca:!1,da:i},this.databaseId,this.Tt,this.ignoreUndefinedProperties)}}function Yu(t){const e=t._freezeSettings(),n=jl(t._databaseId);return new Wu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Ju(t,e,n,i,s,r={}){const o=t.wa(r.merge||r.mergeFields?2:0,e,n,s);nh("Data must be an object, but it was:",o,i);const a=th(i,o);let c,l;if(r.merge)c=new Ra(o.fieldMask),l=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const i of r.mergeFields){const s=ih(e,i,n);if(!o.contains(s))throw new no(eo.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);oh(t,s)||t.push(s)}c=new Ra(t),l=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,l=o.fieldTransforms;return new zu(new La(a),c,l)}function Zu(t,e){if(eh(t=b(t)))return nh("Unsupported field value:",e,t),th(t,e);if(t instanceof Hu)return function(t,e){if(!Qu(e.ra))throw e.fa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.fa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.ca&&4!==e.ra)throw e.fa("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const s of t){let t=Zu(s,e.la(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=b(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ja(e.Tt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=yo.fromDate(t);return{timestampValue:qc(e.Tt,n)}}if(t instanceof yo){const n=new yo(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:qc(e.Tt,n)}}if(t instanceof Ku)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof $u)return{bytesValue:Hc(e.Tt,t._byteString)};if(t instanceof Pu){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e.fa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:zc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.fa(`Unsupported field value: ${Ou(t)}`)}(t,e)}function th(t,e){const n={};return Fo(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Po(t,((t,i)=>{const s=Zu(i,e.ua(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function eh(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof yo||t instanceof Ku||t instanceof $u||t instanceof Pu||t instanceof Hu)}function nh(t,e,n){if(!eh(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=Ou(n);throw"an object"===i?e.fa(t+" a custom object"):e.fa(t+" "+i)}}function ih(t,e,n){if((e=b(e))instanceof qu)return e._internalPath;if("string"==typeof e)return function(t,e,n){if(e.search(sh)>=0)throw rh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new qu(...e.split("."))._internalPath}catch(i){throw rh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e);throw rh("Field path arguments must be of type string or ",t,!1,void 0,n)}const sh=new RegExp("[~\\*/\\[\\]]");function rh(t,e,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new no(eo.INVALID_ARGUMENT,a+t+c)}function oh(t,e){return t.some((t=>t.isEqual(e)))}function ah(t,e){const n=Ru(t.firestore,Bu),i=function(t,e,...n){if(t=b(t),1===arguments.length&&(e=po.R()),_u("doc","path",e),t instanceof xu){const i=bo.fromString(e,...n);return Nu(i),new Pu(t,null,new Io(i))}{if(!(t instanceof Pu||t instanceof Vu))throw new no(eo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(bo.fromString(e,...n));return Nu(i),new Pu(t.firestore,t instanceof Vu?t.converter:null,new Io(i))}}(t),s=function(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}(t.converter,e);return function(t,e){return function(t,e){const n=new io;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const i=Eu(t);try{const t=await function(t,e){const n=to(t),i=yo.now(),s=e.reduce(((t,e)=>t.add(e.key)),Bc());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Oc(),c=Bc();return n.ji.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{r=s;const o=[];for(const t of e){const e=vc(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new Ec(t.key,e,xa(e.value.mapValue),fc.exists(!0)))}return n.mutationQueue.addMutationBatch(t,i,o,e)})).next((e=>{o=e;const i=e.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:xc(r)})))}(i.localStore,e);i.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let i=t.fc[t.currentUser.toKey()];i||(i=new Da(go)),i=i.insert(e,n),t.fc[t.currentUser.toKey()]=i}(i,t.batchId,n),await wu(i,t.changes),await Zl(i.remoteStore)}catch(t){const e=hu(t,"Failed to persist write");n.reject(e)}}(await Au(t),e,n))),n.promise}(function(t){return t._firestoreClient||ju(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(t),e)}(n,[Ju(Yu(t.firestore),"addDoc",i._key,s,null!==t.converter,{}).toMutation(i._key,fc.exists(!1))]).then((()=>i))}!function(t,e=!0){Kr="9.18.0",ot(new E("firestore",((t,{instanceIdentifier:n,options:i})=>{const s=t.getProvider("app").getImmediate(),r=new Bu(new ao(t.getProvider("auth-internal")),new ho(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new no(eo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xo(t.options.projectId,e)}(s,n),s);return i=Object.assign({useFetchStreams:e},i),r._setSettings(i),r}),"PUBLIC").setMultipleInstances(!0)),ft(qr,"3.9.0",t),ft(qr,"3.9.0","esm2017")}();const ch=ut({apiKey:"AIzaSyCli4Q5GQ0aZfRBRXtn9t-2W0UHRboNfjc",authDomain:"gettingstartedwithfireba-a5ca1.firebaseapp.com",projectId:"gettingstartedwithfireba-a5ca1",storageBucket:"gettingstartedwithfireba-a5ca1.appspot.com",messagingSenderId:"300142428339",appId:"1:300142428339:web:457c37e8c27e482bc230c6",measurementId:"G-VFGSKWEKDH"});!function(t=ht()){const e=at(t=b(t),he);e.isInitialized()?e.getImmediate():function(t,e={}){const n=at(t,he);if(n.isInitialized()){const t=n.getImmediate();if(d(e,n.getOptions()))return t;throw we.create("already-initialized")}n.initialize({options:e})}(t)}(ch),console.log(ch);const lh=function(t,e){const n=at(ht(),"firestore").getImmediate({identifier:"(default)"});if(!n._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=r())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]})("firestore");t&&Mu(n,...t)}return n}();Mu(lh,"localhost",8080),document.querySelector(".save").addEventListener("click",(async()=>{const t=function(t,e,...n){if(t=b(t),_u("collection","path",e),t instanceof xu){const i=bo.fromString(e,...n);return ku(i),new Vu(t,null,i)}{if(!(t instanceof Pu||t instanceof Vu))throw new no(eo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(bo.fromString(e,...n));return ku(i),new Vu(t.firestore,null,i)}}(lh,"gadgets"),e=await ah(t,{name:"Phone",os:"Android",version:"11"});console.log(`Created a new gadget: ${e.id}`)}))})();